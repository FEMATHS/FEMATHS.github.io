<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">5 posts tagged with &quot;RL&quot; | 机器学习小纵队</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/tags/rl"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="5 posts tagged with &quot;RL&quot; | 机器学习小纵队"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/tags/rl"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/rl" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/rl" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="机器学习小纵队 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="机器学习小纵队 Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.228fc0ae.css">
<script src="/assets/js/runtime~main.44b7d7ba.js" defer="defer"></script>
<script src="/assets/js/main.89f398f6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="机器学习小纵队" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="机器学习小纵队" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">机器学习小纵队</b></a><a class="navbar__item navbar__link" href="/docs/ch0/FEMATHS-wiki-introduction">计算数学以及机器学习Wiki</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">FEMATHS小组学习日志</a><a class="navbar__item navbar__link" href="/members">FEMATHS小组成员</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/FEMATHS" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/21-A-Physics-Informed-Neural-Network-framework-for-generic-bioreactor-modelling">A Physics-Informed Neural Network (PINN) framework for generic bioreactor modelling</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/23-CityLearn v1.0 An OpenAI Gym Environment for Demand Response with Deep Reinforcement Learning">CityLearn v1.0 - An OpenAI Gym Environment for Demand Response with Deep Reinforcement Learning</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/24-CityLearn v2">CityLearn v2: Energy-flexible, resilient, occupant-centric, and carbon-aware management of grid-interactive communities</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/25-AI classification">AI世界大入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/26-CityLearn_experiment">CityLearn experiment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/assets/25-AI classification">AI世界大入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/22-">A high order explicit time finite element method for the acoustic wave equation with discontinuous coefficients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/20-An efficient hp-Variational PINNs framework for incompressible  Navier-Stokes equations">An efficient hp-Variational PINNs framework for incompressible  Navier-Stokes equations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/19-Multidomain Legendre–Galerkin Chebyshev-collocation method for one-dimensional evolution equations with discontinuity">Multidomain Legendre–Galerkin Chebyshev-collocation method for one-dimensional evolution equations with discontinuity</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/18-HomPINNs_Homotopy_physics-informed_neural_networks_for_learning_multiple_solutions_of_nonlinear_elliptic_differential_equations">HomPINNs: Homotopy physics-informed neural networks for learning multiple solutions of nonlinear elliptic differential equations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/17-An_efficient_neural-network_and_finite-difference_hybrid_method_for_elliptic_interface_problems_with_applications">An efficient neural-network and finite-difference hybrid  method for elliptic interface problems with applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/16-A_new_analytical_formula_for_the_wave_equations_with_variable_coefficients">A new analytical formula for the wave equations with variable coefficients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/15-Novel_and_general_discontinuity-removing_PINNs_for_elliptic_interface_problems">Novel and general discontinuity-removing PINNs for elliptic interface problems</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/14-DeepONet_Learning_nonlinear_operators_for_identifying">DeepONet: Learning nonlinear operators for identifying differential equations based on the universal approximation theorem of operators</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/13-Deep Learning-Based Numerical Methods for High-Dimensional Parabolic Partial Differential Equations and Backward Stochastic Differential Equations">Machine learning based spectral methods for partial differential equations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/12-Related GANs and their SRGAN ablation experiments">Related GANs and their SRGAN ablation experiments</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/05-Automated and Context-Aware Repair of Color-Related Accessibility Issues for Android Apps">Automated and Context-Aware Repair of Color-Related Accessibility Issues for Android Apps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/00-Ahead-of-our-research-efforts">欢迎来到FEMATHS小组学习日志</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/01-how-to-find-good-research-paper">从入门到入土？不，是精通！科技论文完全指南：如何找到一篇合适的科技论文</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/02-how-to-read-research-paper">从入门到入土？不，是精通！科技论文完全指南：如何正确且高效地阅读一篇科技论文</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/03-how-to-write-research-paper">从入门到入土？不，是精通！科技论文完全指南：如何写出一篇优秀的科技论文</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/06-Bioinformatic analysis1（Linux Operation Guide）">Bioinformatic analysis:linux操作指南之上游分析(Part 1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/07-Bioinformatic analysis2（Quality control and clustering）">Bioinformatic analysis:质量控制与聚类分析(Part 2)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/08-Bioinformatic analysis3（Differential genes and cell labeling）">Bioinformatic analysis:差异基因与细胞标注(Part3)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/09-Bioinformatic analysis4（Enrichment analysis）">Bioinformatic analysis:富集分析 (Part4)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/10-Bioinformatic analysis5（PPI and FT Analysis）">Bioinformatic analysis:PPI分析(Part 5)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/11-Bioinformatic analysis6（Sequential analysis）">Bioinformatic analysis:拟时序分析(Part 6)</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/04-Physics-Informed-Deep-Learning-Part-one">Physics Informed Deep Learning (Part I) Data-driven  Solutions of Nonlinear Partial Differential Equations</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>5 posts tagged with &quot;RL&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/23-CityLearn v1.0 An OpenAI Gym Environment for Demand Response with Deep Reinforcement Learning">CityLearn v1.0 - An OpenAI Gym Environment for Demand Response with Deep Reinforcement Learning</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-27T00:00:00.000Z">October 27, 2025</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/95482898?v=4" alt="zqqqj"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">zqqqj</span></a></div><small class="authorTitle_nd0D" title="super bug engineer 4 nlp,robot,cv,ml and ds">super bug engineer 4 nlp,robot,cv,ml and ds</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">abstract<a href="#abstract" class="hash-link" aria-label="Direct link to abstract" title="Direct link to abstract">​</a></h2>
<p>需求响应（Demand Response, DR）可在美国电力需求峰值中减少约 20%，而建筑物占总电力需求的约 70%。然而，建筑能耗系统动态复杂且难以建模，传统方法难以协调不同建筑或能源系统。强化学习（RL）因其自适应、无需模型的特性，能基于历史与实时数据实现智能能耗控制。
然而，目前 DR 领域的研究缺乏统一标准，实验难以复现，算法性能也难以比较。为此，作者提出 CityLearn —— 一个基于 OpenAI Gym 的开源强化学习仿真环境，可让研究者方便地实现、共享、复现并比较不同的 DR 控制算法。该框架模块化、可扩展，支持多种储能与发电设备模型。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">introduction<a href="#introduction" class="hash-link" aria-label="Direct link to introduction" title="Direct link to introduction">​</a></h2>
<p>美国建筑能耗占全国电力消耗的约 70%，且城市区域的电力需求不断上升，造成输电压力与电价上涨。需求响应（DR）通过激励机制引导用户调整用电模式，从而削减峰值负荷、提高电网稳定性。
然而，为了让 DR 真正有效，需要智能、分布式的负载协调。如果所有设备同时响应相同信号，可能只是“移峰”而非“削峰”。传统控制方法（如 MPC）虽有效，但需依赖昂贵且精确的物理建模。
强化学习（RL）可以在无模型的条件下，通过与环境交互学习最优策略，从实时和历史数据中自动优化建筑能耗管理。但该领域缺乏统一标准，使得不同研究难以比较。为此，作者提出了 CityLearn —— 一个面向城市级能耗优化的强化学习仿真框架，用于统一测试环境、便于算法比较与复现</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="citylearn">CityLearn<a href="#citylearn" class="hash-link" aria-label="Direct link to CityLearn" title="Direct link to CityLearn">​</a></h2>
<p>CityLearn 的目标是：为城市级的建筑群（而非单栋建筑）提供一个标准化的 RL 研究平台</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-architecture">1. architecture<a href="#1-architecture" class="hash-link" aria-label="Direct link to 1. architecture" title="Direct link to 1. architecture">​</a></h3>
<p>使用 bottom-up design：
bottom components：能量存储系统（如蓄热、蓄电池）与能量供应系统（如热泵、太阳能）。
Building class：每栋建筑整合了自身的设备模型与能耗需求。
CityLearn class：整合多个建筑，并继承自 OpenAI Gym 环境，使其成为一个可直接与 RL 智能体交互的仿真环境。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-功能特性">2. 功能特性<a href="#2-功能特性" class="hash-link" aria-label="Direct link to 2. 功能特性" title="Direct link to 2. 功能特性">​</a></h3>
<p>语言: Python，可从 GitHub 免费下载。
灵活数据输入：可加载实际建筑的供热/制冷需求数据，也可使用代理模型（surrogate models）。
设备模型：v1.0 版本包含空气源热泵（air-to-water heat pump）、热能储存系统、以及电池模型
建筑热负荷来源：使用 CitySim simu，该工具能在城市尺度下利用几何与物理简化模型估算建筑的热负荷，考虑了太阳辐射、室内活动、热损失等因素。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-relationship-with-openai-gym">3. relationship with OpenAI Gym<a href="#3-relationship-with-openai-gym" class="hash-link" aria-label="Direct link to 3. relationship with OpenAI Gym" title="Direct link to 3. relationship with OpenAI Gym">​</a></h3>
<ol>
<li>继承 Gym 环境接口，实现与强化学习算法的无缝集成</li>
<li>研究者可直接将现有 Gym 智能体（如 DDPG、PPO、A3C 等）应用于建筑能耗控制。</li>
<li>Gym 生态允许算法间的统一评测与可重现比较，就像 RL 研究中常见的 Atari 或 robotics 环境一样。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-流程图">4. 流程图<a href="#4-流程图" class="hash-link" aria-label="Direct link to 4. 流程图" title="Direct link to 4. 流程图">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://8.130.141.48/wp-content/uploads/2025/10/17613777480983.jpg" alt="" class="img_ev3q"></p>
<p><strong>part1</strong></p>
<ol>
<li>一个建筑对应一个 agent，智能体通过 Actor 网络（output：动作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">a</span></span></span></span>）和 Critic(output：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">q</span></span></span></span>)网络学习策略</li>
<li>输入为当前环境状态<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">s</span></span></span></span>，输出是控制动作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">a</span></span></span></span></li>
<li>训练时，agent 接收反馈（奖励<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span></span></span></span>，下一状态<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span>）</li>
<li>RL 经典交互循环为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s, a, r, s_{t+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>(state -&gt; action -&gt; reward -&gt; next state)</li>
</ol>
<p><strong>part2</strong></p>
<ol>
<li>电网向各建筑提供电能。</li>
<li>电价（price）会随时间变化（例如分时电价或高峰电价）。</li>
<li>各建筑根据电价调整自己的用电需求（demand）。</li>
</ol>
<p>强化学习的目标就是学会在不同电价和需求下，削峰填谷（peak shaving），以降低整体用电成本并平滑负荷曲线。</p>
<p><strong>part3</strong></p>
<ol>
<li>Heat pump（热泵）：负责制冷或供热，是主要的能耗设备。</li>
<li>Energy storage（储能系统）：可以在低价时储能、高价时放能，用于平滑能耗。</li>
<li>Building cooling loads（建筑冷负荷）：代表建筑内部的能量需求（例如空调负荷）。
这三部分构成了一个局部能源系统并与电网交互，在此可以理解为数据集</li>
</ol>
<p><strong>part4</strong>
整个城市中有 n 栋建筑，对应 n 个 agents。各建筑既独立学习，又可以共享信息或通过价格信号间接协调，以此实现整体的分布式能耗优化
最终目标是让整个城区的负荷曲线更平滑，降低峰值功率需求。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="demo">demo<a href="#demo" class="hash-link" aria-label="Direct link to demo" title="Direct link to demo">​</a></h2>
<p>不演示了，因为是 v1 版本，我觉得已经过时了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to conclusion" title="Direct link to conclusion">​</a></h2>
<p>懒的说了，前面解释的很清楚了</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/rl">RL</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/24-CityLearn v2">CityLearn v2: Energy-flexible, resilient, occupant-centric, and carbon-aware management of grid-interactive communities</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-27T00:00:00.000Z">October 27, 2025</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/95482898?v=4" alt="zqqqj"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">zqqqj</span></a></div><small class="authorTitle_nd0D" title="super bug engineer 4 nlp,robot,cv,ml and ds">super bug engineer 4 nlp,robot,cv,ml and ds</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract">​</a></h2>
<p>随着越来越多的分布式能源成为需求侧基础设施的一部分，量化它们在社区规模上提供的能源灵活性非常重要，特别是要了解地理、气候和居住者行为差异对其有效性的影  响，以及确定最佳控制策略以加速其在现实世界中的应用。CityLearn 为简单和先进的分布式能源控制算法提供基准测试环境，包括基于规则的、模型预测的和强化学习控制。本文介绍的 CityLearn v2 扩展了 CityLearn v1，它提供了一个模拟环境，利用美国建筑库存数据集的最终用途负载概况来创建虚拟网格交互社区，用于弹性、多代理分布式能源和具有动态乘员反馈的目标控制。这项工作详细介绍了 v2 环境设计，并提供了利用强化学习来管理电池储能系统充放电周期、车辆到电网控制以及热泵功率调制期间的热舒适性的应用示例</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一-introduction">一. introduction<a href="#一-introduction" class="hash-link" aria-label="Direct link to 一. introduction" title="Direct link to 一. introduction">​</a></h2>
<p>V1 版本很牛，RL 也很牛，但是出于一些缺陷我们创建了 v2
缺点：
灵活性有限 —— v1 的场景结构和数据接口固定，难以扩展到新的建筑类型、设备或能源载体；
可扩展性受限 —— v1 的配置较为僵化，不支持多层能源系统或跨区域交互；
可复现性不足 —— 不同研究者在构建实验时往往需要修改底层代码，导致实验结果难以公平比较。
V2 改进点：
v2 版本在体系结构上进行了彻底重构，支持模块化设计和多层能源系统建模。研究者可以轻松地定义新的建筑类型、能源设备、价格信号、碳排放约束、以及能源共享机制。此外，v2 引入了统一的配置文件系统和标准化的评测接口，使不同实验能够方便地复现与对比。
通过这些改进，CityLearn v2 旨在成为一个面向未来的研究平台，支持：
· 单智能体与多智能体强化学习；
· 集中式与分布式控制；
· 电力与热能的多能源协同；
· 公平、透明的算法评测与结果共享。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="常见缩写">常见缩写：<a href="#常见缩写" class="hash-link" aria-label="Direct link to 常见缩写：" title="Direct link to 常见缩写：">​</a></h3>
<p><strong>ESSs</strong>：energy storage systems
<strong>DERs</strong>：Distributed energy resources，指分散在不同地点的小型能源设施，如太阳能电池板、风力涡轮机、燃料电池等，可以为当地的能源需求提供可再生能源。
<strong>EVs</strong>：Electric vehicles
<strong>G2V</strong>：grid-to-vehicle
<strong>V2G</strong>：and vehicle-to-grid
<strong>PV</strong>：photovoltaic，光电伏打的，光电的
<strong>DR</strong>：demand response</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二-environment">二. environment<a href="#二-environment" class="hash-link" aria-label="Direct link to 二. environment" title="Direct link to 二. environment">​</a></h2>
<p>这是 Building model 的总体流程图
<img decoding="async" loading="lazy" src="http://8.130.141.48/wp-content/uploads/2025/10/17613885450058-scaled.jpg" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-建筑模型building-model">2.1 建筑模型（Building model）<a href="#21-建筑模型building-model" class="hash-link" aria-label="Direct link to 2.1 建筑模型（Building model）" title="Direct link to 2.1 建筑模型（Building model）">​</a></h3>
<p>针对小细节，由以下几个部分构成：
还需要声明的是，这些公式不需要转化为代码进行计算，这已经包含在运算包里了，这些公式主要是为了能了解环境中某一个细节是有哪些因素构成的（所以公式也较为简单）</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-电能与热能平衡electric-and-thermal-energy-balance">2.1.1 电能与热能平衡（Electric and thermal energy balance）<a href="#211-电能与热能平衡electric-and-thermal-energy-balance" class="hash-link" aria-label="Direct link to 2.1.1 电能与热能平衡（Electric and thermal energy balance）" title="Direct link to 2.1.1 电能与热能平衡（Electric and thermal energy balance）">​</a></h4>
<p>建筑在每个时间步 ( t ) 的净能耗由其电力与热力流量平衡关系决定。<br>
<!-- -->对任意建筑 ( b )，电力平衡可表示为：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>grid</mtext></msubsup><mo>=</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>load</mtext></msubsup><mo>−</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>PV</mtext></msubsup><mo>−</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>discharge</mtext></msubsup><mo>+</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>charge</mtext></msubsup></mrow><annotation encoding="application/x-tex">E_{t,b}^{\text{grid}} = E_{t,b}^{\text{load}} - E_{t,b}^{\text{PV}} - E_{t,b}^{\text{discharge}} + E_{t,b}^{\text{charge}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">grid</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">load</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">PV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">discharge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">charge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span></span></span></span></span>
<p>其中：</p>
<ul>
<li><code>(E_{t,b}^{\text{grid}})</code>：从电网汲取的净电能；</li>
<li><code>(E_{t,b}^{\text{load}})</code>：总电力负荷（包括 HVAC、DHW、家电与电动车等）；</li>
<li><code>(E_{t,b}^{\text{PV}})</code>：光伏系统输出；</li>
<li><code>(E_{t,b}^{\text{discharge}})</code>、<code>(E_{t,b}^{\text{charge}})</code>：分别为储能放电与充电功率。</li>
</ul>
<p>热力系统的能量守恒为：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>Q</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi></mrow><mtext>storage</mtext></msubsup><mo>=</mo><msubsup><mi>Q</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>storage</mtext></msubsup><mo>+</mo><msub><mi>η</mi><mi>c</mi></msub><msubsup><mi>Q</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>charge</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><msub><mi>η</mi><mi>d</mi></msub></mfrac><msubsup><mi>Q</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>discharge</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Q_{t+1,b}^{\text{storage}} = Q_{t,b}^{\text{storage}} + \eta_c Q_{t,b}^{\text{charge}} \Delta t - \frac{1}{\eta_d} Q_{t,b}^{\text{discharge}} \Delta t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">storage</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">storage</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">charge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.2019em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">discharge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span>
<p>能量约束为：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Q</mi><mi>min</mi><mo>⁡</mo></msub><mo>≤</mo><msubsup><mi>Q</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>storage</mtext></msubsup><mo>≤</mo><msub><mi>Q</mi><mi>max</mi><mo>⁡</mo></msub></mrow><annotation encoding="application/x-tex">Q_{\min} \le Q_{t,b}^{\text{storage}} \le Q_{\max}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">storage</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-hvac-与空间热动力学hvac-and-space-thermal-dynamics">2.1.2 HVAC 与空间热动力学（HVAC and space thermal dynamics）<a href="#212-hvac-与空间热动力学hvac-and-space-thermal-dynamics" class="hash-link" aria-label="Direct link to 2.1.2 HVAC 与空间热动力学（HVAC and space thermal dynamics）" title="Direct link to 2.1.2 HVAC 与空间热动力学（HVAC and space thermal dynamics）">​</a></h4>
<p>室内温度动态遵循一阶热阻–热容（RC）模型：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>T</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup><mo>=</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup><mo>+</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><msub><mi>C</mi><mi>b</mi></msub></mfrac><mrow><mo fence="true">[</mo><mfrac><mrow><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>out</mtext></msubsup><mo>−</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup></mrow><msub><mi>R</mi><mi>b</mi></msub></mfrac><mo>+</mo><msubsup><mi>η</mi><mi>b</mi><mtext>HVAC</mtext></msubsup><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>HVAC</mtext></msubsup><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">T_{t+1,b}^{\text{in}} = T_{t,b}^{\text{in}} + \frac{\Delta t}{C_b} \left[ \frac{T_{t,b}^{\text{out}} - T_{t,b}^{\text{in}}}{R_b} + \eta_b^{\text{HVAC}} P_{t,b}^{\text{HVAC}} \right]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2636em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8805em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2636em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8805em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6397em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.8092em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7936em"><span style="top:-2.4169em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">out</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4192em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8305em"><span style="top:-2.4169em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4192em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">HVAC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">HVAC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size4">]</span></span></span></span></span></span></span>
<p>参数定义：</p>
<ul>
<li><code>(R_b, C_b)</code>：建筑热阻与热容；</li>
<li><code>(T^{\text{in}})</code>：室内温度；</li>
<li><code>(T^{\text{out}})</code>：室外温度；</li>
<li><code>(\eta_b^{\text{HVAC}})</code>：HVAC 效率；</li>
<li><code>(P_{t,b}^{\text{HVAC}})</code>：HVAC 功率输入；</li>
<li><code>(\Delta t)</code>：时间步长。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-生活热水系统domestic-hot-water-dhw">2.1.3 生活热水系统（Domestic hot water, DHW）<a href="#213-生活热水系统domestic-hot-water-dhw" class="hash-link" aria-label="Direct link to 2.1.3 生活热水系统（Domestic hot water, DHW）" title="Direct link to 2.1.3 生活热水系统（Domestic hot water, DHW）">​</a></h4>
<p>热水储能的动态方程：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">E_{t+1,b}^{\text{DHW}} = E_{t,b}^{\text{DHW}} + \eta_c P_{t,b}^{\text{heat}} \Delta t - \frac{1}{\eta_d} P_{t,b}^{\text{draw}} \Delta t</span><br></span></code></pre></div></div>
<p>其中：</p>
<ul>
<li><code>(P_{t,b}^{\text{heat}})</code>：热水设备功率；</li>
<li><code>(P_{t,b}^{\text{draw}})</code>：用水导致的热能损耗；</li>
<li><code>(\eta_c, \eta_d)</code>：充放热效率；</li>
<li><code>(E_{t,b}^{\text{DHW}})</code>：热水罐储能。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="214-电力储能系统electrical-storage-system">2.1.4 电力储能系统（Electrical storage system）<a href="#214-电力储能系统electrical-storage-system" class="hash-link" aria-label="Direct link to 2.1.4 电力储能系统（Electrical storage system）" title="Direct link to 2.1.4 电力储能系统（Electrical storage system）">​</a></h4>
<p>电池能量更新方程：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi></mrow><mtext>bat</mtext></msubsup><mo>=</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>bat</mtext></msubsup><mo>+</mo><msub><mi>η</mi><mi>c</mi></msub><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>ch</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><msub><mi>η</mi><mi>d</mi></msub></mfrac><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>dis</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">E_{t+1,b}^{\text{bat}} = E_{t,b}^{\text{bat}} + \eta_c P_{t,b}^{\text{ch}} \Delta t - \frac{1}{\eta_d} P_{t,b}^{\text{dis}} \Delta t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bat</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bat</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ch</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.2019em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dis</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span>
<p>功率约束：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0</mn><mo>≤</mo><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>ch</mtext></msubsup><mo>≤</mo><msubsup><mi>P</mi><mi>max</mi><mo>⁡</mo><mtext>ch</mtext></msubsup><mo separator="true">,</mo><mspace width="1em"></mspace><mn>0</mn><mo>≤</mo><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>dis</mtext></msubsup><mo>≤</mo><msubsup><mi>P</mi><mi>max</mi><mo>⁡</mo><mtext>dis</mtext></msubsup></mrow><annotation encoding="application/x-tex">0 \le P_{t,b}^{\text{ch}} \le P_{\max}^{\text{ch}}, \quad 0 \le P_{t,b}^{\text{dis}} \le P_{\max}^{\text{dis}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ch</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1461em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ch</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dis</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1461em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dis</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span></span></span></span></span>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="215-光伏发电photovoltaic-generation">2.1.5 光伏发电（Photovoltaic generation）<a href="#215-光伏发电photovoltaic-generation" class="hash-link" aria-label="Direct link to 2.1.5 光伏发电（Photovoltaic generation）" title="Direct link to 2.1.5 光伏发电（Photovoltaic generation）">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>PV</mtext></msubsup><mo>=</mo><msubsup><mi>A</mi><mi>b</mi><mtext>PV</mtext></msubsup><mo>⋅</mo><msubsup><mi>η</mi><mi>b</mi><mtext>PV</mtext></msubsup><mo>⋅</mo><msub><mi>G</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">P_{t,b}^{\text{PV}} = A_b^{\text{PV}} \cdot \eta_b^{\text{PV}} \cdot G_t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">PV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">PV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">PV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>
<p>其中：</p>
<ul>
<li><code>(A_b^{\text{PV}})</code>：光伏阵列面积；</li>
<li><code>(\eta_b^{\text{PV}})</code>：光伏转换效率；</li>
<li><code>(G_t)</code>：太阳辐照度。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="216-电动车充电electric-vehicle-ev">2.1.6 电动车充电（Electric vehicle, EV）<a href="#216-电动车充电electric-vehicle-ev" class="hash-link" aria-label="Direct link to 2.1.6 电动车充电（Electric vehicle, EV）" title="Direct link to 2.1.6 电动车充电（Electric vehicle, EV）">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi></mrow><mtext>EV</mtext></msubsup><mo>=</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>EV</mtext></msubsup><mo>+</mo><msub><mi>η</mi><mi>c</mi></msub><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>EV</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">E_{t+1,b}^{\text{EV}} = E_{t,b}^{\text{EV}} + \eta_c P_{t,b}^{\text{EV}} \Delta t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span>
<p>约束条件：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mi>min</mi><mo>⁡</mo><mtext>EV</mtext></msubsup><mo>≤</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>EV</mtext></msubsup><mo>≤</mo><msubsup><mi>E</mi><mi>max</mi><mo>⁡</mo><mtext>EV</mtext></msubsup><mo separator="true">,</mo><mspace width="1em"></mspace><mn>0</mn><mo>≤</mo><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>EV</mtext></msubsup><mo>≤</mo><msubsup><mi>P</mi><mi>max</mi><mo>⁡</mo><mtext>EV</mtext></msubsup></mrow><annotation encoding="application/x-tex">E_{\min}^{\text{EV}} \le E_{t,b}^{\text{EV}} \le E_{\max}^{\text{EV}}, \quad 0 \le P_{t,b}^{\text{EV}} \le P_{\max}^{\text{EV}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2744em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em"><span></span></span></span></span></span></span></span></span></span></span>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="217-住户交互模型occupant-interaction-model">2.1.7 住户交互模型（Occupant interaction model）<a href="#217-住户交互模型occupant-interaction-model" class="hash-link" aria-label="Direct link to 2.1.7 住户交互模型（Occupant interaction model）" title="Direct link to 2.1.7 住户交互模型（Occupant interaction model）">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>set,eff</mtext></msubsup><mo>=</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>set,agent</mtext></msubsup><mo>+</mo><msub><mi>δ</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{t,b}^{\text{set,eff}} = T_{t,b}^{\text{set,agent}} + \delta_{t,b}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">set,eff</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">set,agent</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03785em">δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0379em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span>
<ul>
<li><code>(T_{t,b}^{\text{set,agent}})</code>：智能体设定温度；</li>
<li><code>(\delta_{t,b})</code>：住户偏差（可随机或基于舒适度模型）。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="218-舒适度约束comfort-constraints">2.1.8 舒适度约束（Comfort constraints）<a href="#218-舒适度约束comfort-constraints" class="hash-link" aria-label="Direct link to 2.1.8 舒适度约束（Comfort constraints）" title="Direct link to 2.1.8 舒适度约束（Comfort constraints）">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mrow><mi>min</mi><mo>⁡</mo><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo>≤</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup><mo>≤</mo><msub><mi>T</mi><mrow><mi>max</mi><mo>⁡</mo><mo separator="true">,</mo><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{\min,b} \le T_{t,b}^{\text{in}} \le T_{\max,b}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2636em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8805em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span>
<p>惩罚项：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>r</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>comfort</mtext></msubsup><mo>=</mo><mo>−</mo><msub><mi>α</mi><mi>b</mi></msub><mo>⋅</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup><mo>−</mo><msub><mi>T</mi><mrow><mi>max</mi><mo>⁡</mo><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo stretchy="false">)</mo><mo>−</mo><msub><mi>β</mi><mi>b</mi></msub><mo>⋅</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msub><mi>T</mi><mrow><mi>min</mi><mo>⁡</mo><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo>−</mo><msubsup><mi>T</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>in</mtext></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_{t,b}^{\text{comfort}} = -\alpha_b \cdot \max(0, T_{t,b}^{\text{in}} - T_{\max,b}) - \beta_b \cdot \max(0, T_{\min,b} - T_{t,b}^{\text{in}})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2822em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-2.453em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">comfort</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2636em;vertical-align:-0.3831em"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8805em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2636em;vertical-align:-0.3831em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8805em"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">in</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="219-成本与排放energy-cost-and-emissions">2.1.9 成本与排放（Energy cost and emissions）<a href="#219-成本与排放energy-cost-and-emissions" class="hash-link" aria-label="Direct link to 2.1.9 成本与排放（Energy cost and emissions）" title="Direct link to 2.1.9 成本与排放（Energy cost and emissions）">​</a></h4>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo>=</mo><msub><mi>p</mi><mi>t</mi></msub><mo>⋅</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>grid</mtext></msubsup><mo separator="true">,</mo><mspace width="1em"></mspace><msub><mi>Z</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo>=</mo><msub><mi>ϵ</mi><mi>t</mi></msub><mo>⋅</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>grid</mtext></msubsup></mrow><annotation encoding="application/x-tex">C_{t,b} = p_t \cdot E_{t,b}^{\text{grid}}, \quad Z_{t,b} = \epsilon_t \cdot E_{t,b}^{\text{grid}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">grid</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">grid</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span></span></span></span></span>
<p>其中：</p>
<ul>
<li><code>(p_t)</code>：时变电价；</li>
<li><code>(\epsilon_t)</code>：单位电能碳排放（kgCO₂e/kWh）。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2110-总结summary">2.1.10 总结（Summary）<a href="#2110-总结summary" class="hash-link" aria-label="Direct link to 2.1.10 总结（Summary）" title="Direct link to 2.1.10 总结（Summary）">​</a></h4>
<p>建筑模型集成了电力、热力、储能、光伏、热水、电动车与住户行为的多物理量方程。<br>
<!-- -->环境会自动根据这些方程更新建筑状态，为强化学习智能体提供观测、动作空间及奖励反馈。</p>
<p>**说明：**这些物理/能量学公式都已在框架内部实现。实际使用时主要通过配置场景与输出动作即可，但是理解这些公式有助于掌握环境机制与调参逻辑。所以依旧先给出具体公式</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-power-outage-model停电模型">2.2 Power outage model（停电模型）<a href="#22-power-outage-model停电模型" class="hash-link" aria-label="Direct link to 2.2 Power outage model（停电模型）" title="Direct link to 2.2 Power outage model（停电模型）">​</a></h3>
<p>停电模型，用于模拟建筑在电网中断事件下的运行行为。该模型允许用户定义停电的持续时间、发生时刻、影响范围（单建筑或全区），</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="模型定义">模型定义<a href="#模型定义" class="hash-link" aria-label="Direct link to 模型定义" title="Direct link to 模型定义">​</a></h4>
<p>用二值变量 <code>o_t</code> 表示时间步 <code>t</code> 的供电状态：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>o</mi><mi>t</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>若发生停电 (power outage)</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>若正常供电 (normal operation)</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">o_t =
\begin{cases}
1, &amp; \text{若发生停电 (power outage)} \\
0, &amp; \text{若正常供电 (normal operation)}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">若发生停电</span><span class="mord"> (power outage)</span></span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">若正常供电</span><span class="mord"> (normal operation)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>当 <code>( o_t = 1)</code> 时，建筑无法从电网获取电能，因此电网交互项被强制为零：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>grid</mtext></msubsup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E_{t,b}^{\text{grid}} = 0
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">grid</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span>
<p>此时，建筑的能量供应必须来自于：</p>
<ul>
<li>本地储能（电池或热储能）；</li>
<li>局部可再生能源（例如光伏发电）；</li>
<li>或削减部分非关键负荷（load shedding）。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="能量守恒与储能支撑">能量守恒与储能支撑<a href="#能量守恒与储能支撑" class="hash-link" aria-label="Direct link to 能量守恒与储能支撑" title="Direct link to 能量守恒与储能支撑">​</a></h4>
<p>在停电状态下，建筑能量平衡更新为：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>E</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi></mrow><mtext>storage</mtext></msubsup><mo>=</mo><msubsup><mi>E</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>storage</mtext></msubsup><mo>+</mo><msub><mi>η</mi><mi>c</mi></msub><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>charge</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><msub><mi>η</mi><mi>d</mi></msub></mfrac><msubsup><mi>P</mi><mrow><mi>t</mi><mo separator="true">,</mo><mi>b</mi></mrow><mtext>discharge</mtext></msubsup><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">E_{t+1,b}^{\text{storage}} =
E_{t,b}^{\text{storage}} +
\eta_c P_{t,b}^{\text{charge}}\Delta t -
\frac{1}{\eta_d} P_{t,b}^{\text{discharge}}\Delta t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">storage</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.3489em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9115em"><span style="top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">storage</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.4044em;vertical-align:-0.4374em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">charge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.2019em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">η</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.967em"><span style="top:-2.3987em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">discharge</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em"><span></span></span></span></span></span></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span>
<p>其中：</p>
<ul>
<li>储能系统在供电中断期间成为主要能量来源；</li>
<li>动作空间可能受到额外约束（如最大放电功率）；</li>
<li>恢复供电后，系统自动切换回正常模式 <code>(o_t = 0)</code>。</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="评估指标">评估指标<a href="#评估指标" class="hash-link" aria-label="Direct link to 评估指标" title="Direct link to 评估指标">​</a></h4>
<p>CityLearn v2 为停电模型提供韧性相关指标，包括：</p>
<ul>
<li><strong>自给率（self-sufficiency ratio）</strong>：停电期间本地可满足的能量比例；</li>
<li><strong>负荷损失率（load loss ratio）</strong>：停电期间未被满足的能量占比；</li>
<li><strong>恢复时间（recovery duration）</strong>：储能充电恢复至正常状态所需时间。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="Direct link to 小结" title="Direct link to 小结">​</a></h4>
<p>这是一个韧性（resilience）测试机制，可以帮助研究者评估强化学习控制策略在 <strong>电网韧性</strong>、<strong>自恢复能力</strong> 和 <strong>关键负荷保障</strong> 方面的性能。
该模块同样也内置于环境中，无需手动实现，只需在场景配置文件中指定停电时段与策略响 应参数即可启用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-key-performance-indicatorskpi">2.3 Key performance indicators（KPI）<a href="#23-key-performance-indicatorskpi" class="hash-link" aria-label="Direct link to 2.3 Key performance indicators（KPI）" title="Direct link to 2.3 Key performance indicators（KPI）">​</a></h3>
<p>就是指标，注意是个最小化指标（越小越好）
<img decoding="async" loading="lazy" src="http://8.130.141.48/wp-content/uploads/2025/10/17613885450058-scaled.jpg" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-datasets">2.4 Datasets<a href="#24-datasets" class="hash-link" aria-label="Direct link to 2.4 Datasets" title="Direct link to 2.4 Datasets">​</a></h3>
<p>没啥好说的</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-environment-design-workflow">2.5 Environment design workflow<a href="#25-environment-design-workflow" class="hash-link" aria-label="Direct link to 2.5 Environment design workflow" title="Direct link to 2.5 Environment design workflow">​</a></h3>
<p>以 EULP dataset 为例，给出改框架的具体流程
<img decoding="async" loading="lazy" src="http://8.130.141.48/wp-content/uploads/2025/10/17615401546467.jpg" alt="" class="img_ev3q">
<strong>1：数据收集</strong>
收集建筑元数据（如建筑类型、区域气候区、设备可用性等）
收集真实或合成的负荷／光伏／天气／电价／碳排放时间序列数据
<strong>2：负荷模拟与数据集准备</strong>
通过建筑热模型、设备模型、行为模型等将原始数据处理为可用的仿真输入（如每栋建筑每小时的负荷、PV 输出、储能状态等），构建环境配置文件（building attributes, DER sizing, shared storage, outage model 等），并生成场景 YAML/JSON 文件
<strong>3：控制模拟与结果报告</strong>
将环境载入框架，训练或评估 RL 或其它控制策略，接着执行动作-观测-奖励（RL 流程）循环，采集结果。最后 根据 KPI 计算性能指标，输出报告或日志</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三-control">三. Control<a href="#三-control" class="hash-link" aria-label="Direct link to 三. Control" title="Direct link to 三. Control">​</a></h2>
<p>没啥用，反正就是阐讲 CityLearn 的控制接口结构及三种控制配置（单智能体、独立多智能体、协同多智能体），同时说明该框架不仅支持 RL，还兼容 RBC 与 MPC 等传统控制算法，以实现从启发式控制到学习控制的统一研究平台。</p>
<p>在<strong>单智能体配置</strong>下，控制智能体与多个建筑呈一对多关系：
一个集中式智能体收集所有建筑的观测，为区域内所有 DER （分布式能源资源） 分配动作，并在每个时间步接收一个统一的奖励值，用以学习通用控制策略。这种方式类似于能源聚合商（energy aggregator）集中管理灵活负荷的分布式控制。</p>
<p><strong>独立多智能体</strong>配置下，控制智能体与建筑是一对一关系：
每个建筑对应一个智能体，因此每个时间步产生与建筑数相等的奖励，并为每栋建筑分别学习独立的控制策略。</p>
<p><strong>协同多智能体</strong>配置与独立多智能体类似，
但智能体之间可以共享信息，以实现协作目标（例如降低区域峰值负荷）
或竞争目标（例如在能源灵活性市场中进行价格竞标）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四-examples">四. Examples<a href="#四-examples" class="hash-link" aria-label="Direct link to 四. Examples" title="Direct link to 四. Examples">​</a></h2>
<p>篇幅原因，看下一篇吧。因为打算复现+解释</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/rl">RL</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/25-AI classification">AI世界大入门</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-27T00:00:00.000Z">October 27, 2025</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/95482898?v=4" alt="zqqqj"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">zqqqj</span></a></div><small class="authorTitle_nd0D" title="super bug engineer 4 nlp,robot,cv,ml and ds">super bug engineer 4 nlp,robot,cv,ml and ds</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">introduction<a href="#introduction" class="hash-link" aria-label="Direct link to introduction" title="Direct link to introduction">​</a></h2>
<p>这篇文章旨在理解一大堆杂七杂八的，狗屁倒灶的，ai 方向的专用名词，例 AI，NLP，CV，深度学习，强化学习等等等
我相信初学者肯定会对这些名词感到困惑，就如同第一天我在面试时提出的问题：
“我就只会数学建模和西瓜皮上的那些算法，好奇的问一下深度学习是啥？”
这个问题对现在的我来说也相当困惑，当然我相信写完这篇文章会让我的理顺这些东西</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preliminary-knowledge">preliminary knowledge<a href="#preliminary-knowledge" class="hash-link" aria-label="Direct link to preliminary knowledge" title="Direct link to preliminary knowledge">​</a></h2>
<p>首先，给我整个 AI 的框架</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">人工智能（Artificial Intelligence, AI）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 机器学习（Machine Learning, ML）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 监督学习（Supervised Learning）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 无监督学习（Unsupervised Learning）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 强化学习（Reinforcement Learning, RL）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── 其他（半监督、主动学习等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 深度学习（Deep Learning, DL）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 神经网络（CNN, RNN, Transformer）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 自监督学习（Self-supervised）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 生成模型（GAN, Diffusion, VAE）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── PINNs / SciML（物理引导模型）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── 应用领域</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── NLP（自然语言处理）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── CV（计算机视觉）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── Speech（语音）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── 多模态 / 大模型（GPT, Gemini, etc.）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>按照参差结构来讲，先从最简单的开始吧</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-应用领域">1. 应用领域<a href="#1-应用领域" class="hash-link" aria-label="Direct link to 1. 应用领域" title="Direct link to 1. 应用领域">​</a></h3>
<p>搜索算法，符号推理这些其实都可以类比到实习中的“搜推广”（搜索推荐广告）算法工程师。这些东西其实都可以归结为应用领域或技术范式。如下所示</p>
<table><thead><tr><th>名称</th><th>类别</th><th>解释</th></tr></thead><tbody><tr><td><strong>NLP（自然语言处理）</strong></td><td>应用领域</td><td>使用深度学习模型（如 Transformer）处理文本</td></tr><tr><td><strong>CV（计算机视觉）</strong></td><td>应用领域</td><td>使用 CNN 或 ViT 处理图像</td></tr><tr><td><strong>Diffusion / GAN / VAE</strong></td><td>生成模型</td><td>深度学习中的一种模型类型（生成任务）</td></tr><tr><td><strong>大模型（Foundation Model）</strong></td><td>模型规模/范式</td><td>基于深度学习（Transformer）的通用 大模型，如 GPT、Gemini</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-机器学习">2. 机器学习<a href="#2-机器学习" class="hash-link" aria-label="Direct link to 2. 机器学习" title="Direct link to 2. 机器学习">​</a></h3>
<p>机器学习就是大部分西瓜皮上的内容了，他的本意就是“让计算机自己去学习”，所以就会自然而言的牵扯到两大类别，即无监督学习和有监督学习，具体含义如下</p>
<table><thead><tr><th>类型</th><th>中文含义</th><th>训练方式</th><th>示例</th></tr></thead><tbody><tr><td><strong>监督学习 (Supervised Learning)</strong></td><td>有标签学习</td><td>已知输入与期望输出，通过最小化预测误差进行训练</td><td>分类、回归、图像识别</td></tr><tr><td><strong>无监督学习 (Unsupervised Learning)</strong></td><td>无标签学习</td><td>在未标注数据中自动提取潜在结构或模式</td><td>聚类、降维、自编码器</td></tr><tr><td><strong>强化学习 (Reinforcement Learning)</strong></td><td>奖励驱动学习</td><td>智能体与环境交互，通过试错获得最大累计奖励</td><td>游戏 AI、机器人控制</td></tr></tbody></table>
<p>对于强化学习而言，这部分会在后续着重介绍（因为我真的不懂）。但是一般而言，按照“想让机器学到什么”的定义，又可如下分类
· 监督学习用于“从已有示例中学习”
· 无监督学习用于“理解数据结构”
· 强化学习用于“学习行动策略”</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-深度学习">3. 深度学习<a href="#3-深度学习" class="hash-link" aria-label="Direct link to 3. 深度学习" title="Direct link to 3. 深度学习">​</a></h3>
<p>深度学习是机器学习的一个重要分支，可以理解为使用多层神经网络（Neural Networks）自动学习数据特征的一类方法
换句话说，它依然遵循“最小化误差（loss function）”的思想，但与传统 机器学习不同，<br>
<!-- -->深度学习不再需要人手去“提取特征”，而是通过层层网络结构自动完成特征提取与抽象表示</p>
<p>从集合关系上看：
深度学习 ⊂ 神经网络 ⊂ 机器学习 ⊂ 人工智能
例子：</p>
<table><thead><tr><th>层级</th><th>学到的特征（以图像识别为例）</th></tr></thead><tbody><tr><td>第 1 层</td><td>学到边缘、线条等简单模式</td></tr><tr><td>第 2 层</td><td>学到角点、纹理、局部形状</td></tr><tr><td>第 3 层</td><td>学到眼睛、鼻子等复杂结构</td></tr><tr><td>第 4 层及以上</td><td>学到“猫脸”“汽车”等语义概念</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="difference-between-deep-learningdl-and-machine-learningml">difference between Deep Learning（DL） and machine Learning（ML）<a href="#difference-between-deep-learningdl-and-machine-learningml" class="hash-link" aria-label="Direct link to difference between Deep Learning（DL） and machine Learning（ML）" title="Direct link to difference between Deep Learning（DL） and machine Learning（ML）">​</a></h2>
<p>尽管两者的本质都是最小化误差（如 loss function），但核心目的是不同的。ML 的目的是寻找使预测误差最小的参数。（比如在 n 次线性函数中找最优参数，神经网络调整通过 Adam 反向传播调整网络权重）</p>
<table><thead><tr><th>算法</th><th>优化目标</th><th>损失函数举例</th></tr></thead><tbody><tr><td>线性回归</td><td>拟合直线</td><td>MSE（均方误差）</td></tr><tr><td>逻辑回归</td><td>分类概率</td><td>交叉熵（Cross Entropy）</td></tr><tr><td>SVM</td><td>最大化间隔</td><td>Hinge Loss</td></tr><tr><td>决策树</td><td>信息增益最大化</td><td>熵（Entropy）</td></tr></tbody></table>
<p>DL 也确实是继承了这个想法（最小化误差），但它的关键区别在于 “模型复杂度” 和 “特征获取方式”</p>
<table><thead><tr><th>方面</th><th>机器学习（ML）</th><th>深度学习（DL）</th></tr></thead><tbody><tr><td>特征</td><td>需要人工提取（feature engineering）</td><td>网络自动学习特征</td></tr><tr><td>模型结构</td><td>简单模型（线性/树/核函数）</td><td>多层非线性神经网络</td></tr><tr><td>参数规模</td><td>少（几十～几百）</td><td>多（百万～数十亿）</td></tr><tr><td>优化方法</td><td>梯度下降、凸优化</td><td>反向传播 + SGD/Adam</td></tr><tr><td>可解释性</td><td>强</td><td>弱</td></tr><tr><td>数据需求</td><td>较少</td><td>巨量数据</td></tr></tbody></table>
<p>其实可以理解为，DL 本质就是神经网络，只是这个网络又大（神经元）又深（多层）。深度学习不只是有神经网络，还包括优化算法、损失函数、正则化、数据增强等。神经网络是模型，深度学习是方法。
最大的目的就是：<strong>为了学习特征。区别在于可以更好的处理高度非线形问题</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="强化学习">强化学习<a href="#强化学习" class="hash-link" aria-label="Direct link to 强化学习" title="Direct link to 强化学习">​</a></h2>
<p>说了这么多，终于可以讲强化学习了，强化学习是让智能体（Agent）通过与环境（Environment）交互，并根据奖励（Reward）反馈，学习最优决策策略（Policy）的方法。
需要注意的是，这是一个最大化优化，不是 loss 这样的最小化优化（奖励必然是越多越好）</p>
<p>继续举例五大基本元素</p>
<table><thead><tr><th>元素</th><th>英文</th><th>含义</th><th>举例（机器人走迷宫）</th></tr></thead><tbody><tr><td><strong>Agent</strong></td><td>智能体</td><td>负责做决策的学习者</td><td>机器人本身</td></tr><tr><td><strong>Environment</strong></td><td>环境</td><td>Agent 所处的世界</td><td>迷宫</td></tr><tr><td><strong>State</strong></td><td>状态（s）</td><td>当前环境的观测</td><td>机器人现在的位置</td></tr><tr><td><strong>Action</strong></td><td>动作（a）</td><td>Agent 可以执行的操作</td><td>向上/下/左/右移动</td></tr><tr><td><strong>Reward</strong></td><td>奖励（r）</td><td>环境给的反馈信号</td><td>到终点+1，撞墙-1</td></tr></tbody></table>
<p>p-code 如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for episode in range(N):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state = env.reset()     # Agent观察环境（init啦其实就是）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while not done:     # 开始训练</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action = agent.select_action(state)     # 选择一个动作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        next_state, reward, done = env.step(action)     # 环境给出新的状态和奖励；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent.learn(state, action, reward, next_state)  # Agent根据奖励更新策略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state = next_state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>所以，强化学习不是预测一个矢量或标量，他的目的应该是学习一种<strong>策略</strong></p>
<p>ps：some cases</p>
<table><thead><tr><th>领域</th><th>应用场景</th><th>说明</th></tr></thead><tbody><tr><td>游戏</td><td>AlphaGo、Atari、Dota2</td><td>通过自我博弈学习最优策略</td></tr><tr><td>机器人控制</td><td>行走、抓取、平衡</td><td>连续动作空间优化</td></tr><tr><td>自动驾驶</td><td>路径规划、决策控制</td><td>学习最优驾驶策略</td></tr><tr><td>智能电网</td><td>城市能源优化（CityLearn）</td><td>控制能耗和储能系统</td></tr><tr><td>金融</td><td>投资组合优化</td><td>最大化长期收益</td></tr></tbody></table></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/rl">RL</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/26-CityLearn_experiment">CityLearn experiment</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-27T00:00:00.000Z">October 27, 2025</time> · <!-- -->25 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/95482898?v=4" alt="zqqqj"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">zqqqj</span></a></div><small class="authorTitle_nd0D" title="super bug engineer 4 nlp,robot,cv,ml and ds">super bug engineer 4 nlp,robot,cv,ml and ds</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码路径httpsgithubcomzqqqqqqj1110citylearn_expgit">代码路径：<a href="https://github.com/zqqqqqqj1110/CityLearn_exp.git" target="_blank" rel="noopener noreferrer">https://github.com/zqqqqqqj1110/CityLearn_exp.git</a><a href="#代码路径httpsgithubcomzqqqqqqj1110citylearn_expgit" class="hash-link" aria-label="Direct link to 代码路径httpsgithubcomzqqqqqqj1110citylearn_expgit" title="Direct link to 代码路径httpsgithubcomzqqqqqqj1110citylearn_expgit">​</a></h2>
<h1>target</h1>
<p>比较不同任务配置下，RBC（Rule-Based Control）与 RLC（Reinforcement Learning Control）在能源、排放、峰值与舒适度方面的表现。
数量： 共 17 个任务（单建筑、多建筑、单目标、多目标）
输出指标：</p>
<ol>
<li>Electricity Cost [$]</li>
<li>Emissions [kg CO₂]</li>
<li>Peak Demand [kW]</li>
<li>Discomfort Penalty [–]</li>
</ol>
<h1>准备环境</h1>
<p>创建环境，准备 citylearn 的 conda env</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda create -n citylearn python=3.10 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda activate citylearn</span><br></span></code></pre></div></div>
<p>安装 city learn V2</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/intelligent-environments-lab/CityLearn.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd CityLearn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -e .    # 源码控制版，仅用于复现</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install citylearn   # 后续试验可以直接用这个下载</span><br></span></code></pre></div></div>
<p>如果是 macOS，pip install 的时候会发生如下报错：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: Ignored the following versions that require a different python version: 2.3.0 Requires-Python &gt;=3.11; 2.3.1 Requires-Python &gt;=3.11; 2.3.2 Requires-Python &gt;=3.11; 2.3.3 Requires-Python &gt;=3.11; 2.3.4 Requires-Python &gt;=3.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: Could not find a version that satisfies the requirement openstudio&lt;=3.3.0 (from citylearn) (from versions: 3.5.0, 3.5.1, 3.6.0, 3.6.1, 3.7.0rc1, 3.7.0, 3.8.0, 3.9.0, 3.10.0rc5, 3.10.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: No matching distribution found for openstudio&lt;=3.3.0</span><br></span></code></pre></div></div>
<p>这是因为 OpenStudio 只支持 x86 架构，Apple Silicon (arm64) 下没有编译版本，跳过依赖，自己手动安装</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install -e . --no-deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install numpy==1.26.4 pandas pyyaml scikit-learn==1.2.2 simplejson torch torchvision gymnasium==0.28.1 nrel-pysam doe_xstock</span><br></span></code></pre></div></div>
<p>这边建议还是用 linux 比较好，后续复现都基于 Linux 而非 macOS，macOS 的环境配置等我有空了再写（毕竟本地运行最方便）</p>
<p>目前 macOS 失败的原因：<strong>OpenStudio 不支持 macOS ARM 架构</strong></p>
<h1>进行测试</h1>
<p>配置完环境之后，可以使用测试代码看看效果</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.citylearn import CityLearnEnv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载 CityLearn 环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema = Path(&#x27;/root/CityLearn/data/datasets/citylearn_challenge_2021/schema.json&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env = CityLearnEnv(schema=schema)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Env loaded successfully!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重置环境（Gymnasium 风格）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs, info = env.reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 打印建筑数量与ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Number of buildings:&quot;, len(env.buildings))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 打印每栋建筑的观测长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs_lens = [len(o) for o in obs]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Observation lengths per building:&quot;, obs_lens)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 示例：查看第一个建筑的前5个特征</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Sample observation (Building 1):&quot;, obs[0][:5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果要转换为矩阵，可以先对齐长度（取最短长度或补零）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_len = min(obs_lens)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs_array = np.array([o[:min_len] for o in obs])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Converted obs array shape:&quot;, obs_array.shape)</span><br></span></code></pre></div></div>
<p>有五个 ✅ 就 ok 了，输出结果应该如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(citylearnv2) root@autodl-container-491e4b9a34-9e5b11d5:~/CityLearn# python Untitled1.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Couldn&#x27;t import dot_parser, loading of dot files will not be possible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Env loaded successfully!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Number of buildings: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Observation lengths per building: [28, 27, 26, 27, 28, 28, 27, 27, 27]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Sample observation (Building 1): [1, 4, 1, 9.4, 10.020000457763672]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Converted obs array shape: (9, 26)</span><br></span></code></pre></div></div>
<p>number of buildings 可以理解为 agent 的数量，每一个 agent 都是一个独立的智能体，共享天气、电价、碳排放等全局信息，共同学习协调策略
Observation lengths per building 是每个 agent 的特征数量，这些特征可以是
当前电价，CO₂ 强度，当前时刻，设备能耗（DHW、TES、Battery） 等
Sample observation 把一栋建筑的特征编码成一个一维数组，具体含义取决于 schema 的配置（observations 字段），如下所示：
<img decoding="async" loading="lazy" src="http://8.130.141.48/wp-content/uploads/2025/11/17616169599159-scaled.jpg" alt="" class="img_ev3q">
Converted obs array shape 是传入到模型的数组，是一个大整体，用于训练</p>
<h1>Control task distribution</h1>
<p>该章节设计了 17 个不同的控制任务，对比 3 种控制方式 + 4 种控制目标。三种方法在代码中的本质区别就是 reward 不同，需要在传入 CityLearnEnv() 时，自定义 Reward Function</p>
<table><thead><tr><th>控制器</th><th>简介</th><th>类型</th></tr></thead><tbody><tr><td><strong>Baseline</strong></td><td>无控制，直接跟随负荷曲线</td><td>被动</td></tr><tr><td><strong>RBC (rule-based controller)</strong></td><td>手工设定规则，例如“电价低时充电”</td><td>基准控制</td></tr><tr><td><strong>RLC (reinforcement learning controller)</strong></td><td>SAC 算法自动学习策略</td><td>强化学习</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-cost-or-emission-reduction">1. Cost or Emission Reduction<a href="#1-cost-or-emission-reduction" class="hash-link" aria-label="Direct link to 1. Cost or Emission Reduction" title="Direct link to 1. Cost or Emission Reduction">​</a></h2>
<p>以最小化电费成本或碳排放总量为 KPI，进行三种方式的训练</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-实验设置">1.1 实验设置<a href="#11-实验设置" class="hash-link" aria-label="Direct link to 1.1 实验设置" title="Direct link to 1.1 实验设置">​</a></h3>
<p>数据集： CityLearn Challenge 2023 (Phase 2 local evaluation)
建筑： 9 栋住宅
控制对象： DHW (热水储能) 或 BESS + PV (电池储能+光伏)
控制变量： 储能充放电功率</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-环境">1.2 环境<a href="#12-环境" class="hash-link" aria-label="Direct link to 1.2 环境" title="Direct link to 1.2 环境">​</a></h3>
<p>Baseline – 不做任何控制。
RBC – 手动规则：
电价低 → 充能；
电价高 → 放能。
SAC – 深度强化学习自动学习最优调度</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-代码">1.3 代码<a href="#13-代码" class="hash-link" aria-label="Direct link to 1.3 代码" title="Direct link to 1.3 代码">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.citylearn import CityLearnEnv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.base import BaselineAgent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.rbc import BasicRBC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.sac import SAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run(agent_class, schema, episodes=1, central_agent=True, save_dir=None, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;\n=== Running {agent_class.__name__} ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env = CityLearnEnv(schema, central_agent=central_agent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = agent_class(env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results = env.evaluate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;✅ {agent_class.__name__} finished.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if save_dir:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Path(save_dir).mkdir(parents=True, exist_ok=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Path(save_dir)/&quot;metrics.txt&quot;).write_text(str(results))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 使用本地数据集 schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema = &quot;data/datasets/citylearn_challenge_2023_phase_2_local_evaluation/schema.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 1 Baseline 无控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res_base = run(BaselineAgent, schema, episodes=1, central_agent=True, save_dir=&quot;results/4_1_1_baseline&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 2 RBC 规则控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res_rbc = run(BasicRBC, schema, episodes=1, central_agent=True, save_dir=&quot;results/4_1_1_rbc&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 3 SAC 强化学习控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res_sac = run(SAC, schema, episodes=5, central_agent=False, save_dir=&quot;results/4_1_1_sac&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 输出对比结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== Comparison ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;Baseline:&quot;, res_base)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;RBC:&quot;, res_rbc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;SAC:&quot;, res_sac)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre></div></div>
<p>目的是在相同环境下，依次运行三种控制策略（Baseline → RBC → SAC），并保存结果。主体是 run 函数，就详细讲他了
run 函数是一个通用的实验运行函数，分为一下步骤</p>
<ol>
<li>初始化环境</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">env = CityLearnEnv(schema, central_agent=central_agent)</span><br></span></code></pre></div></div>
<p>CityLearnEnv 是 CityLearn 的核心环境类，它根据 schema.json 读取城市能耗数据（建筑负荷、电价、太阳能、天气等）。
参数：
schema: 定义数据来源与环境配置（相当于一个配置文件路径）
central_agent: 是否为集中式控制（True 表示一个智能体控制所有建筑）</p>
<ol start="2">
<li>初始化智能体</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">agent = agent_class(env)</span><br></span></code></pre></div></div>
<p>BaselineAgent：完全不做控制（仅被动执行环境动作）
BasicRBC：基于规则的控制（Rule-Based Control）
SAC：强化学习算法 Soft Actor-Critic 控制器</p>
<ol start="3">
<li>训练智能体</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span></code></pre></div></div>
<p>episodes：训练轮数（你给 Baseline/RBC 各 1 次，SAC 给 5 次）
deterministic_finish=True：在最后一个 episode 以确定性方式结束（用于评估)</p>
<ol start="4">
<li>评估结果</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">results = env.evaluate()</span><br></span></code></pre></div></div>
<p>返回一个性能指标字典，如能耗、峰值负荷、碳排放、成本等</p>
<ol start="5">
<li>打印与保存</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-问题汇总">1.4 问题汇总<a href="#14-问题汇总" class="hash-link" aria-label="Direct link to 1.4 问题汇总" title="Direct link to 1.4 问题汇总">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="141-rbc规则控制的规则是什么代码中怎么体现">1.4.1 RBC（规则控制）的规则是什么？代码中怎么体现？<a href="#141-rbc规则控制的规则是什么代码中怎么体现" class="hash-link" aria-label="Direct link to 1.4.1 RBC（规则控制）的规则是什么？代码中怎么体现？" title="Direct link to 1.4.1 RBC（规则控制）的规则是 什么？代码中怎么体现？">​</a></h4>
<p>RBC（Rule-Based Control）是 基于人工经验规则的控制策略。在 CityLearn 中，RBC 主要负责控制每栋建筑的储能设备（电池）何时充电、何时放电。
默认规则如下：
当电价低（off-peak）时 → 充电
当电价高（peak）时 → 放电
若电池满或空 → 不动作
逻辑定义在 city learn 包的该文件中：citylearn/agents/rbc.py。简单的来说，就是一个 if else 而已</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="142-sac强化学习控制用的是什么算法">1.4.2. SAC（强化学习控制）用的是什么算法？<a href="#142-sac强化学习控制用的是什么算法" class="hash-link" aria-label="Direct link to 1.4.2. SAC（强化学习控制）用的是什么算法？" title="Direct link to 1.4.2. SAC（强化学习控制）用的是什么算法？">​</a></h4>
<p>SAC 是 Soft Actor-Critic）算法，基于最大熵强化学习（Maximum Entropy RL）的连续动作控制算法。就跟流程图中的一样，有三部分构成</p>
<table><thead><tr><th>模块</th><th>类型</th><th>功能</th></tr></thead><tbody><tr><td>Actor</td><td>策略网络</td><td>生成动作分布</td></tr><tr><td>Critic₁ / Critic₂</td><td>Q 网络</td><td>评估动作价值</td></tr><tr><td>Target Critic</td><td>目标网络</td><td>稳定训练</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="143-rbc-规则能否自定义">1.4.3. RBC 规则能否自定义<a href="#143-rbc-规则能否自定义" class="hash-link" aria-label="Direct link to 1.4.3. RBC 规则能否自定义" title="Direct link to 1.4.3. RBC 规则能否自定义">​</a></h4>
<p>BasicRBC 是 CityLearn 自带的默认规则控制器（定义在 rbc.py）。但完全可以自定义自己的规则。只需继承基类并重写 select_actions()即可
例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.base import BaseAgent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyRBC(BaseAgent):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def select_actions(self, observations):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for obs in observations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            price = obs[&#x27;electricity_price&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            soc = obs[&#x27;storage_soc&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            solar = obs[&#x27;solar_generation&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if price &lt; 0.05 and solar &gt; 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                action = 1.0      # 加强充电</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            elif price &gt; 0.2 or soc &gt; 0.8:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                action = -1.0     # 放电</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                action = 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            actions.append(action)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run(MyRBC, schema, episodes=1, central_agent=True)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="144-sac-强化学习控制是否和问题-3-一样">1.4.4. SAC 强化学习控制是否和问题 3 一样？<a href="#144-sac-强化学习控制是否和问题-3-一样" class="hash-link" aria-label="Direct link to 1.4.4. SAC 强化学习控制是否和问题 3 一样？" title="Direct link to 1.4.4. SAC 强化学习控制是否和问题 3 一样？">​</a></h4>
<p>也可以和问题 3 一样，自定义，只要实现相同接口即可
例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.base import BaseAgent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from stable_baselines3 import PPO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class PPOAgent(BaseAgent):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, env):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.model = PPO(&#x27;MlpPolicy&#x27;, env, verbose=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def learn(self, episodes=1, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.model.learn(total_timesteps=episodes * len(self.env.time_steps))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def select_actions(self, observations):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action, _ = self.model.predict(observations, deterministic=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run(PPOAgent, schema, episodes=5, central_agent=False)</span><br></span></code></pre></div></div>
<p>ps：schema 文件中 reward_function 配置（具体在 2.2 中解释）</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;reward_function&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;citylearn.reward_function.RewardFunction&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;attributes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;electricity_cost_weight&quot;: 0.6,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;emission_weight&quot;: 0.4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;peak_to_average_ratio_weight&quot;: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-peak-reduction">2. Peak Reduction<a href="#2-peak-reduction" class="hash-link" aria-label="Direct link to 2. Peak Reduction" title="Direct link to 2. Peak Reduction">​</a></h2>
<p>以削减社区总功率峰值为 KPI，进行三种方式的训练</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-环境">2.1 环境<a href="#21-环境" class="hash-link" aria-label="Direct link to 2.1 环境" title="Direct link to 2.1 环境">​</a></h3>
<p>RBC 仍按规则上述运行
SAC 自动学会错峰操作——让各建筑在不同时间放电。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-代码">2.2 代码<a href="#22-代码" class="hash-link" aria-label="Direct link to 2.2 代码" title="Direct link to 2.2 代码">​</a></h3>
<p>4.1.2 节中明确指出，实验目标变为降低峰值负荷（district-level daily peak load）。文中说明：
“Configurations with peak reduction objective… The RBC has been fine-tuned to target energy discharge during peak periods…”</p>
<p>而在 CityLearn 环境中，KPI 由 reward_function 控制。所以要把 4.1.1 的“cost / emission minimization” 改成 4.1.2 的“peak reduction”，只需在 schema.json 里修改 reward 配置即可。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;reward_function&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;citylearn.reward_function.RewardFunction&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;attributes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;electricity_cost_weight&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;emission_weight&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;peak_to_average_ratio_weight&quot;: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>其他代码与 4.1.1 相同</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-discomfort-and-electricity-consumption-reduction">3. Discomfort and Electricity Consumption Reduction<a href="#3-discomfort-and-electricity-consumption-reduction" class="hash-link" aria-label="Direct link to 3. Discomfort and Electricity Consumption Reduction" title="Direct link to 3. Discomfort and Electricity Consumption Reduction">​</a></h2>
<p>KPI 为在节能的同时维持舒适度（供暖、热水温度等）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-代码">3.1 代码<a href="#31-代码" class="hash-link" aria-label="Direct link to 3.1 代码" title="Direct link to 3.1 代码">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;reward_function&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;citylearn.reward_function.ComfortReward&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;attributes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;band&quot;: 1.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lower_exponent&quot;: 2.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;higher_exponent&quot;: 3.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;m&quot;: 3.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;mode&quot;: &quot;cooling&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">summary<a href="#summary" class="hash-link" aria-label="Direct link to summary" title="Direct link to summary">​</a></h2>
<p>在 4.1 部分的实验中，通过修改 schema.json 中的 reward_function 配置即可切换不同的性能评价指标（KPI）与控制目标，从而实现基于不同优化目标的策略训练</p>
<table><thead><tr><th>类名</th><th>所属模块</th><th>简要说明</th><th>可配参数（kwargs/attributes）示例</th></tr></thead><tbody><tr><td><code>RewardFunction</code></td><td><code>citylearn.reward_function</code></td><td>默认通用奖励函数，惩罚从网格购买电力。 ([citylearn.net][1])</td><td><code>exponent</code>（如 1.0）、<code>charging_constraint_penalty_coefficient</code> 等</td></tr><tr><td><code>MARL</code></td><td><code>citylearn.reward_function</code></td><td>用于多体（multi-agent）场景的奖励函数</td><td>无或少量额外参数</td></tr><tr><td><code>IndependentSACReward</code></td><td><code>citylearn.reward_function</code></td><td>推荐用于每建筑独立 agent 的 SAC 控制器奖励。</td><td>无或少量参数</td></tr><tr><td><code>SolarPenaltyReward</code></td><td><code>citylearn.reward_function</code></td><td>鼓励净零／最大化自发电、减少从电网购电。</td><td>默认行为，无需额外参数或可配置参数如系数</td></tr><tr><td><code>ComfortReward</code></td><td><code>citylearn.reward_function</code></td><td>以室内温度偏差（舒适度）为目标的奖励函数。</td><td><code>band</code>（舒适带宽）、<code>lower_exponent</code>、<code>higher_exponent</code> 等</td></tr><tr><td><code>SolarPenaltyAndComfortReward</code></td><td><code>citylearn.reward_function</code></td><td>结合太阳能惩罚 + 舒适度惩罚的混合型奖励。</td><td><code>band</code>、<code>lower_exponent</code>、<code>higher_exponent</code>、<code>coefficients</code> 等</td></tr></tbody></table>
<p>所有的 reward_function 可以在这看：<a href="https://www.citylearn.net/api/citylearn.reward_function.html?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">https://www.citylearn.net/api/citylearn.reward_function.html?utm_source=chatgpt.com</a></p>
<p>当然，以上仅针对 SAC，如果是 RBC，需要修改 rbc.py 文件里的策略，不过我觉得重点是 SAC，所以暂且就先不管 RBC 的规则修改了</p>
<h1>Energy storage system control in representative single-family neighborhoods</h1>
<p>如果说 4.1 是多目标基准测试（环境固定，控制算法固定，KPI 不同），那 4.2 就是<strong>不同建筑类型（如单层房、多层房、带太阳能的房屋）具有不同负荷特性与储能需求，同样的控制算法在这些“代表性住宅”上会表现出不同的能耗动态。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-重点">1. 重点<a href="#1-重点" class="hash-link" aria-label="Direct link to 1. 重点" title="Direct link to 1. 重点">​</a></h2>
<ol>
<li>采用相同的 RL 控制策略（通常是 SAC）；</li>
<li>在不同的 “representative neighborhoods” schema 上运行；</li>
<li>比较结果
· 电池充放电曲线 (SOC)
· 负荷曲线平滑程度
· 成本或碳排结果差异</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-区别">2. 区别<a href="#2-区别" class="hash-link" aria-label="Direct link to 2. 区别" title="Direct link to 2. 区别">​</a></h2>
<table><thead><tr><th>项目</th><th>4.1 部分</th><th>4.2 部分</th></tr></thead><tbody><tr><td><strong>实验主题</strong></td><td>Benchmark 实验：在统一城市社区下测试不同 KPI（成本、碳排、峰值、舒适度）</td><td>应用实验：测试控制算法在<strong>代表性住宅社区</strong>的真实储能控制性能</td></tr><tr><td><strong>实验目标（KPI）</strong></td><td>切换不同 reward_function，比较不同优化目标</td><td>固定 reward（通常是 cost/emission），考察算法在不同建筑类型下的行为差异</td></tr><tr><td><strong>控制结构</strong></td><td>集中式或半集中式控制（central_agent 可 True）</td><td><strong>分布式控制</strong>（central_agent=False，每栋建筑独立 agent）</td></tr><tr><td><strong>环境规模</strong></td><td>通常是完整城市或区域（多个住宅+商用建筑）</td><td>缩小到单家庭或少量代表性住宅群</td></tr><tr><td><strong>重点分析</strong></td><td>“不同 KPI 下的优化目标”</td><td>“储能系统在现实住宅场景中的动态控制表现”</td></tr><tr><td><strong>输出指标</strong></td><td>reward 曲线、总能耗、PAR</td><td>每户建筑的电池 SOC 曲线、功率负荷、峰值变化趋势</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-代码">3. 代码<a href="#3-代码" class="hash-link" aria-label="Direct link to 3. 代码" title="Direct link to 3. 代码">​</a></h2>
<p>和 4.1 其实大同小异，central_agent=False 即可，突出各 agent 单独训练</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ============================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CityLearn 4.2 实验复现: Energy storage system control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 参考论文 Section 4.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ============================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.citylearn import CityLearnEnv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.base import BaselineAgent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.rbc import BasicRBC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.sac import SAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from debug_sac import DebugSAC  # ✅ 使用调试版本，不改库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试用，仅使用n栋buildings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run(agent_class, schema, episodes=1, central_agent=False, save_dir=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;\n=== Running {agent_class.__name__} | Central Agent = {central_agent} ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ✅ 正确选择前三栋建筑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env_full = CityLearnEnv(schema, central_agent=central_agent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selected_buildings = env_full.buildings[:20]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env_full.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ✅ 用3栋建筑创建新环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env = CityLearnEnv(schema, buildings=selected_buildings, central_agent=central_agent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = agent_class(env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results = env.evaluate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;✅ {agent_class.__name__} finished.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;📊 Results: {results}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if save_dir:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Path(save_dir).mkdir(parents=True, exist_ok=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Path(save_dir) / &quot;metrics.txt&quot;).write_text(str(results))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># def run(agent_class, schema, episodes=1, central_agent=False, save_dir=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     print(f&quot;\n=== Running {agent_class.__name__} | Central Agent = {central_agent} ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # ✅ 创建环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     env = CityLearnEnv(schema, buildings=env.buildings[:3], central_agent=False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # env = CityLearnEnv(schema, central_agent=central_agent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     env.reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # ✅ 创建 Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     agent = agent_class(env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # ✅ 训练 Agent（Baseline / RBC 会自动跳过 learn）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # ✅ 评估指标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     results = env.evaluate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     env.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     print(f&quot;✅ {agent_class.__name__} finished.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     print(f&quot;📊 Results: {results}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     # ✅ 保存结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     if save_dir:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         Path(save_dir).mkdir(parents=True, exist_ok=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#         (Path(save_dir) / &quot;metrics.txt&quot;).write_text(str(results))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     return results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema = &quot;data/datasets/ca_alameda_county_neighborhood/schema.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    central_agent = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Baseline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent_class=BaselineAgent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema=schema,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        episodes=1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        central_agent=central_agent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save_dir=&quot;results/4_2_baseline_CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # RBC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent_class=BasicRBC,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema=schema,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        episodes=1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        central_agent=central_agent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save_dir=&quot;results/4_2_rbc_CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # SAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent_class=DebugSAC,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema=schema,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        episodes=5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        central_agent=central_agent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save_dir=&quot;results/4_2_sac_CA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-报错">4. 报错<a href="#4-报错" class="hash-link" aria-label="Direct link to 4. 报错" title="Direct link to 4. 报错">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-assertionerror">4.1 AssertionError<a href="#41-assertionerror" class="hash-link" aria-label="Direct link to 4.1 AssertionError" title="Direct link to 4.1 AssertionError">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AssertionError: demand is greater than heating_device max output | timestep: 0, building: resstock-amy2018-2021-release-1-122940, outage: False, demand: 3.1614, output: 2.9663, difference: 0.1950</span><br></span></code></pre></div></div>
<p>CityLearn 在 building.py 里写了安全检查,类型如下</p>
<table><thead><tr><th>原因类型</th><th>说明</th><th>是否致命</th></tr></thead><tbody><tr><td><strong>1️⃣ 数据异常</strong></td><td>某个住宅在输入数据（温度 / 负荷）首小时数值异常，使 heating_demand 超出设备额定功率</td><td>❌ 可跳过</td></tr><tr><td><strong>2️⃣ 模型初始化误差</strong></td><td>在 simulation_start_time_step=0 时，系统状态还没初始化完全，出现轻微不一致</td><td>❌ 可忽略</td></tr><tr><td><strong>3️⃣ 温控模型精度问题</strong></td><td>HVAC 模型在某些时刻计算的 heat_demand 与设备参数有微小误差</td><td>❌ 可通过容差参数放宽</td></tr></tbody></table>
<p>可以打开 citylearn/building.py
查找并修改：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># before</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assert self.power_outage or demand &lt;= max_device_output or abs(demand - max_device_output) &lt; TOLERANCE, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f&quot;demand is greater than heating_device max output | ...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if not (self.power_outage or demand &lt;= max_device_output or abs(demand - max_device_output) &lt; TOLERANCE):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;[Warning] demand &gt; heating_device max output at timestep {self.time_step}&quot;)</span><br></span></code></pre></div></div>
<p>或者跑代码的时候直接 python -O run_4_2.py（忽略所有 assert 语句）</p>
<p>或者把容忍度从 1e-4 改大一些也行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TOLERANCE = 1e-4</span><br></span></code></pre></div></div>
<p>但是总体而言问题不大，论文里说了，在基于 ResStock 的建筑数据中，由于缩放差异，初始化时可能会出现轻微的设备容量超限，这不会影响实验结果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-typeerror-new-data-must-be-a-sequence-got-nonetype">4.2 TypeError: new(): data must be a sequence (got NoneType)<a href="#42-typeerror-new-data-must-be-a-sequence-got-nonetype" class="hash-link" aria-label="Direct link to 4.2 TypeError: new(): data must be a sequence (got NoneType)" title="Direct link to 4.2 TypeError: new(): data must be a sequence (got NoneType)">​</a></h3>
<p>先看报错内容</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(citylearnv2) root@autodl-container-491e4b9a34-9e5b11d5:~/CityLearn# python -O run_4_2.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Couldn&#x27;t import dot_parser, loading of dot files will not be possible.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=== Running SAC ===</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Traceback (most recent call last):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/run_4_2.py&quot;, line 44, in &lt;module&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/run_4_2.py&quot;, line 40, in main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run(SAC, schema, episodes=5, central_agent=central_agent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/run_4_2.py&quot;, line 16, in run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/citylearn/agents/base.py&quot;, line 156, in learn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actions = self.predict(observations, deterministic=deterministic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/citylearn/agents/sac.py&quot;, line 189, in predict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actions = self.get_post_exploration_prediction(observations, deterministic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File &quot;/root/CityLearn/citylearn/agents/sac.py&quot;, line 206, in get_post_exploration_prediction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o = torch.FloatTensor(o).unsqueeze(0).to(self.device)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TypeError: new(): data must be a sequence (got NoneType)</span><br></span></code></pre></div></div>
<p>常见成因如下</p>
<ol>
<li>
<p>初始化观测没准备好
部分版本/数据（尤其 LSTM/ResStock 建筑）在创建后第一拍的观测可能为空：
· 没 reset()
· 或 reset() 返回完第一帧仍需要一个“热身 step”才有有效 obs</p>
</li>
<li>
<p>schema 的观测被关了
如果 root.observations 里全都 &quot;active&quot;: false，或某些建筑在 buildings.*.inactive_observations 里把所有可观测量都禁用了，该建筑（甚至全局）观测会变成 None/空。</p>
</li>
<li>
<p>观测形态不匹配
central_agent=True → 期望得到“一个联合向量”；
central_agent=False → 期望“每栋一个向量的列表”。
如果有建筑 include: false / 观测被裁，列表里就会混入 None。</p>
</li>
</ol>
<p><strong>PS：太他妈变态了这个问题，这个 error 卡了我将近一周才知道哪里出现了问题</strong></p>
<p>解决方法（过于变态，我选择讲我怎么解决的）</p>
<ol>
<li>从数据集入手
可以运行一下这个代码，先查看 building 和 obs 里有没有 none</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># inspect_schema.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json, sys, argparse, os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Any, Dict, List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def load_schema(path: str) -&gt; Dict[str, Any]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    txt = open(path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;).read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 先尝试 JSON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data = json.loads(txt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except Exception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 可选：YAML（若安装了 PyYAML）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            import yaml  # pip install pyyaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data = yaml.safe_load(txt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;❌ 既不是 JSON 也不是可解析的 YAML：{e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sys.exit(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 大多数 CityLearn schema 顶层有个 &#x27;root&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return data.get(&#x27;root&#x27;, data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ap = argparse.ArgumentParser()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ap.add_argument(&#x27;--schema&#x27;, required=True, help=&#x27;path/to/schema.json&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = ap.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sc = load_schema(args.schema)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== Top-level keys ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(list(sc.keys()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 1) central_agent &amp; sim period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== Simulation/Agent ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;central_agent:&quot;, sc.get(&#x27;central_agent&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;simulation_start_time_step:&quot;, sc.get(&#x27;simulation_start_time_step&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;simulation_end_time_step:&quot;, sc.get(&#x27;simulation_end_time_step&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;seconds_per_time_step:&quot;, sc.get(&#x27;seconds_per_time_step&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 2) observations（全局）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obs = sc.get(&#x27;observations&#x27;, {})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== Global Observations ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not obs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;⚠️  observations 是空的（这会导致 SAC 观测为 None）&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actives = [k for k,v in obs.items() if isinstance(v, dict) and v.get(&#x27;active&#x27;, False)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inactives = [k for k,v in obs.items() if isinstance(v, dict) and not v.get(&#x27;active&#x27;, False)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;active 数量:&quot;, len(actives))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;active 列表(前20):&quot;, actives[:20])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if inactives:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(&quot;inactive 列表(前20):&quot;, inactives[:20])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 3) buildings（ 字典或列表）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b = sc.get(&#x27;buildings&#x27;, {})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== Buildings ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if isinstance(b, dict):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b_names = list(b.keys())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;建筑数量:&quot;, len(b_names))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sample = b_names[:5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;示例建筑:&quot;, sample)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 检查 include / inactive_observations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        problem_buildings: List[str] = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fully_inactive: List[str] = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for name in b_names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cfg = b[name] or {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            include = cfg.get(&#x27;include&#x27;, True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if not include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                problem_buildings.append(name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            inact = cfg.get(&#x27;inactive_observations&#x27;, [])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 如果把全局 active 都屏蔽了，也会导致该建筑 obs=None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                actives = [k for k,v in obs.items() if isinstance(v, dict) and v.get(&#x27;active&#x27;, False)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if actives and isinstance(inact, list) and set(inact) &gt;= set(actives):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    fully_inactive.append(name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if problem_buildings:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;⚠️  有 {len(problem_buildings)} 栋建筑 include=false（可能导致 None）：&quot;, problem_buildings[:5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if fully_inactive:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;⚠️  有 {len(fully_inactive)} 栋建筑把所有全局观测都屏蔽了：&quot;, fully_inactive[:5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;⚠️  buildings 不是字典（请贴内容我再看）&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 4) 快速“环境探针”（不训练，只 reset 看看 obs 形态）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from citylearn.citylearn import CityLearnEnv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ca = sc.get(&#x27;central_agent&#x27;, False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;\n=== Env probe (reset) ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env = CityLearnEnv(args.schema, central_agent=ca)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        obs0 = env.reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;reset() 返回类型:&quot;, type(obs0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if obs0 is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(&quot;❌ reset() 返回 None —— SAC 会在 FloatTensor(None) 处报错。&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # centralized → 向量/数组；decentralized → list[数组]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if isinstance(obs0, list):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    shapes = [getattr(x, &#x27;shape&#x27;, None) for x in obs0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    print(&quot;分布式观测数量:&quot;, len(obs0), &quot;示例形状:&quot;, shapes[:5])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    print(&quot;集中式观测形状:&quot;, getattr(obs0, &#x27;shape&#x27;, None))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;（可选探针失败：）&quot;, e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="http://8.130.141.48/wp-content/uploads/2025/11/17622520053493-scaled.jpg" alt="" class="img_ev3q">
我的运行结果</p>
<ol>
<li>进行调试
从报错中可以知道，问题主要是出现在 sac.py 的 self.get_post_exploration_prediction 里，再建一个 py 文件重写该类，查看到底是哪一步出现了问题</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.sac import SAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DebugSAC(SAC):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;调试用 SAC：不改原库，但打印 observation &amp; None 来源&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_post_exploration_prediction(self, observations, deterministic=False):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # ✅ 如果是 dict，先转换为 list，避免原始错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if isinstance(observations, dict):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            observations = [obs for obs in observations.values()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i, o in enumerate(observations):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # ✅ Debug：打印原始 obs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;\n🔍 [Debug] Building {i} raw obs = {o}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if o is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raise ValueError(f&quot;❌ Observation from agent {i} is None (raw environment output)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # ✅ 编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            encoded = self.get_encoded_observations(i, o)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;   ➤ Encoded obs = {encoded}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if encoded is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raise ValueError(f&quot;❌ get_encoded_observations() returned None for agent {i}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # ✅ 归一化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            normalized = self.get_normalized_observations(i, encoded)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(f&quot;   ➤ Normalized obs = {normalized}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if normalized is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raise ValueError(f&quot;❌ get_normalized_observations() returned None for agent {i}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # ✅ 尝试转成 tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                o_tensor = torch.FloatTensor(normalized).unsqueeze(0).to(self.device)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                print(f&quot;❌ Failed to convert obs to tensor. Obs = {normalized}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raise e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # ✅ 原来的 action 获取流程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            result = self.policy_net[i].sample(o_tensor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            a = result[2] if deterministic else result[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            actions.append(a.detach().cpu().numpy()[0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return actions</span><br></span></code></pre></div></div>
<p>把步骤分开，终于！找到了问题所在--normalized，为什么会有这个问题呢？
<strong>reason：</strong>
CityLearn SAC 中归一化机制没有被初始化 / 未启用或遇到了无效值，所以 get_normalized_observations() 返回了 None → 传给 torch.FloatTensor() → 报错
这是 CityLearn SAC 框架的一个“设计缺陷”（默认不开启 normalization，又没有 fallback 机制）
citylearn 的默认流程是这样的：</p>
<ol>
<li>normalization_enable 默认是 True</li>
<li>但 normalization 参数（mean/std）只会在训练若干步后才更新</li>
<li>第 1 个 timestep 直接调用 predict() → normalization 矩阵还没有 → 返回 None</li>
</ol>
<p><strong>soluation</strong>
归一化在 SAC 中还是需要的，不然会难以收敛或不稳定，而且不能修改 schema 里的数据（json 里保存的都是真实原始数据）
两种方法</p>
<ol>
<li>在训练前自动收集数据，初始化 mean/std</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 初始化 normalization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs_buffer = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs = env.reset()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for _ in range(500):  # 收集前 500 步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action = env.action_space.sample()   # 随机动作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obs, _, _, _ = env.step(action)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obs_list = list(obs.values()) if isinstance(obs, dict) else obs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obs_buffer.extend(obs_list)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obs_buffer = np.array(obs_buffer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agent.obs_mean = np.mean(obs_buffer, axis=0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agent.obs_std = np.std(obs_buffer, axis=0) + 1e-6  # 避免除0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;✅ Normalization initialized.&quot;)</span><br></span></code></pre></div></div>
<ol start="2">
<li>中途动态归一化
在 SAC 内部每收集一批数据就更新 mean/std（类似 running mean）,只需训练前手动运行几步 env.step() + agent.observe() 即可。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-1">summary<a href="#summary-1" class="hash-link" aria-label="Direct link to summary" title="Direct link to summary">​</a></h2>
<p>4.1 是算法在不同 KPI 下的“目标函数对比实验”；
4.2 是同一算法在不同住宅场景下的“实际储能控制实验”。
针对 TypeError: new():：
在 CityLearn + SAC 中，归一化之所以会出现 None 并报错，是因为强化学习里的智能体（agent）是通过与环境逐步交互来“学习观察数据的分布”，而不是像传统机器学习那样在一开始就加载所有数据并计算整体均值和标准差。归一化需要用到观测数据的均值和标准差（mean/std），但在训练初期，agent 还没有收集到足够的观测数据，这些归一化参数尚未建立，因此 get_normalized_observations() 返回了 None。也就是说，错误并不是由原始数据或环境造成的，而是因为“agent 还不了解环境的数据分布，却提前尝试对整个环境进行归一化”。解决方法可以是跳过归一化、在训练前进行 warm-up 收集数据以初始化均值和标准差，或使用 centralized agent 等方式。</p>
<h1>Vehicle-to-Grid Control</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-重点与目标">1. 重点与目标<a href="#1-重点与目标" class="hash-link" aria-label="Direct link to 1. 重点与目标" title="Direct link to 1. 重点与目标">​</a></h2>
<p>在 CityLearn 环境中扩展强化学习模型，使得电动汽车不仅能充电 ，还能在高峰时段将电能回馈给建筑或电网，以实现削峰填谷和整体能耗优化，目标如下</p>
<ol>
<li>将 V2G 机制引入智能电网中的多建筑控制框架；</li>
<li>探究 RL 智能体如何在建筑储能系统与电动汽车电池之间协调能量流动；</li>
<li>目标函数不仅考虑电费最小化，还考虑排放、峰值负荷和舒适度约束。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-环境设置">2. 环境设置<a href="#2-环境设置" class="hash-link" aria-label="Direct link to 2. 环境设置" title="Direct link to 2. 环境设置">​</a></h2>
<p>在 CityLearn 环境中，每栋建筑不仅有 battery 储能系统，还额外配置 EV battery，RL 智能体的动作空间包括：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>a</mi><mi>t</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><msub><mi>a</mi><mtext>building battery</mtext></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>a</mi><mtext>EV battery</mtext></msub><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">a_t = \left[ a_{\text{building battery}},\ a_{\text{EV battery}} \right]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">building battery</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">EV battery</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em">]</span></span></span></span></span></span>
<p>其中每个<code>a_t</code>都表示充/放电比例；</p>
<ul>
<li>EV 的<strong>可用时间窗口</strong>由住宅用户行为数据确定（车辆通常白天离家、夜晚接入电网）；</li>
<li>充电功率受限于<code>P_{\max}</code>，同时遵守 SoC 上下界约束；</li>
<li>动作经过归一化与裁剪，保证物理可行性。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-奖励函数">3. 奖励函数<a href="#3-奖励函数" class="hash-link" aria-label="Direct link to 3. 奖励函数" title="Direct link to 3. 奖励函数">​</a></h2>
<p>典型形式为：</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mi>t</mi></msub><mo>=</mo><mo>−</mo><mi>α</mi><msub><mi>C</mi><mi>t</mi></msub><mo>−</mo><mi>β</mi><msub><mi>E</mi><mi>t</mi></msub><mo>−</mo><mi>γ</mi><msub><mi>P</mi><mrow><mtext>peak</mtext><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_t = -\alpha C_t - \beta E_t - \gamma P_{\text{peak},t}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.0037em">α</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.05278em">β</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord mathnormal" style="margin-right:0.05556em">γ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">peak</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span></span>
<p>where</p>
<ul>
<li><code>C_t</code>：用电成本；</li>
<li><code>E_t</code>：碳排放；</li>
<li><code>P_{\text{peak},t}</code>：峰值功率；</li>
<li><code>\alpha, \beta, \gamma</code>：权重系数。
通过 V2G，智能体学会在高价时段放电、低价时段充电，从而降低综合成本。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-区别">4. 区别<a href="#4-区别" class="hash-link" aria-label="Direct link to 4. 区别" title="Direct link to 4. 区别">​</a></h2>
<table><thead><tr><th style="text-align:left">对比项</th><th style="text-align:left"><strong>4.1 Baseline Control (RBC/Baseline)</strong></th><th style="text-align:left"><strong>4.2 Reinforcement Learning Control (SAC)</strong></th><th style="text-align:left"><strong>4.3 Vehicle-to-Grid Control (V2G)</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>控制对象</strong></td><td style="text-align:left">仅建筑电池 (Building Battery)</td><td style="text-align:left">同上</td><td style="text-align:left">建筑电池 + 电动车电池 (Building + EV Battery)</td></tr><tr><td style="text-align:left"><strong>schema 文件</strong></td><td style="text-align:left"><code>schema.json</code>（基础建筑）</td><td style="text-align:left"><code>schema.json</code>（相同）</td><td style="text-align:left"><code>v2g_schema.json</code> 或 <code>include_ev=True</code></td></tr><tr><td style="text-align:left"><strong>动作空间</strong></td><td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>t</mi></msub><mo>=</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mrow><mi>b</mi><mi>u</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">a_t = [a_{building}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></td><td style="text-align:left">同上</td><td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>t</mi></msub><mo>=</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mrow><mi>b</mi><mi>u</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mrow><mi>E</mi><mi>V</mi></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">a_t = [a_{building}, a_{EV}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em">E</span><span class="mord mathnormal mtight" style="margin-right:0.22222em">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></td></tr><tr><td style="text-align:left"><strong>状态空间</strong></td><td style="text-align:left">建筑电负荷、太阳能、SoC、电价等</td><td style="text-align:left">同上</td><td style="text-align:left">额外包含 EV SoC、EV 可用时间窗口</td></tr><tr><td style="text-align:left"><strong>强化学习智能体</strong></td><td style="text-align:left">无（规则控制）</td><td style="text-align:left">SAC / PPO</td><td style="text-align:left">SAC（支持 EV 充放电调度）</td></tr><tr><td style="text-align:left"><strong>目标函数</strong></td><td style="text-align:left">最小化电费</td><td style="text-align:left">同上</td><td style="text-align:left">最小化电费 + 排放 + 峰值功率（多目标）</td></tr><tr><td style="text-align:left"><strong>新参数</strong></td><td style="text-align:left">—</td><td style="text-align:left">—</td><td style="text-align:left"><code>v2g=True</code> 或 <code>include_ev=True</code></td></tr><tr><td style="text-align:left"><strong>仿真特点</strong></td><td style="text-align:left">单能系统</td><td style="text-align:left">单能系统 + RL 控制</td><td style="text-align:left">多能系统（建筑 + 车辆 + 电网）</td></tr><tr><td style="text-align:left"><strong>创新点</strong></td><td style="text-align:left">传统控制基线</td><td style="text-align:left">RL 适应性学习</td><td style="text-align:left">RL 扩展到双储能协同优化</td></tr></tbody></table>
<p>一句话概括就是，4.3 在 RL 基础上进一步扩展到“建筑 + 电动车”双储能控制，即 Vehicle-to-Grid (V2G)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-代码">5. 代码<a href="#5-代码" class="hash-link" aria-label="Direct link to 5. 代码" title="Direct link to 5. 代码">​</a></h2>
<p>以 4.1 的 SAC 部分为 baseline，如下</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.citylearn import CityLearnEnv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from citylearn.agents.sac import SAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run_v2g(agent_class, schema, episodes=3, central_agent=False, save_dir=None, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;\n=== Running {agent_class.__name__} (Vehicle-to-Grid) ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ✅ 启用 include_evs / v2g 参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env = CityLearnEnv(schema, central_agent=central_agent, include_evs=True, **kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = agent_class(env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent.learn(episodes=episodes, deterministic_finish=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results = env.evaluate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;✅ {agent_class.__name__} (V2G) finished.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if save_dir:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Path(save_dir).mkdir(parents=True, exist_ok=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Path(save_dir)/&quot;metrics.txt&quot;).write_text(str(results))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ✅ 使用含 EV battery 的 V2G 版本 schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema_v2g = &quot;data/citylearn_challenge_2022/v2g_schema.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ✅ 运行 SAC 控制器（Vehicle-to-Grid 实验）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res_v2g = run_v2g(SAC, schema_v2g, episodes=5, central_agent=False, save_dir=&quot;results/4_3_v2g_sac&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\n=== V2G SAC Results ===&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(res_v2g)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre></div></div>
<h1>Occupant comfort feedback during automated demand response</h1>
<p>貌似复现不出来，因为这是一个基于 CityLearn 的 EULP 数据 + Ecobee DYD 的真实用户统计模型，
构建出的半实数据仿真案例（semi-synthetic simulation）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-目的">1. 目的<a href="#1-目的" class="hash-link" aria-label="Direct link to 1. 目的" title="Direct link to 1. 目的">​</a></h2>
<p>研究在自动化需量响应（Automated Demand Response, ADR）期间引入住户舒适度反馈机制对整体电力负载与控制性能的影响。
通过引入住户覆盖（override）模型，模拟当用户感到不舒适时回退恒温器设定温度的行为，同时对比不同层次的住户建模复杂度（Level of Detail, LoD 1–3）对能源成本、峰值负载削减以及住户不适次数的影响</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境配置">环境配置<a href="#环境配置" class="hash-link" aria-label="Direct link to 环境配置" title="Direct link to 环境配置">​</a></h2>
<table><thead><tr><th>模块</th><th>配置 / 说明</th></tr></thead><tbody><tr><td><strong>CityLearn 版本</strong></td><td>2.4.2（或 ≥ 2.4）</td></tr><tr><td><strong>Python 版本</strong></td><td>3.10+</td></tr><tr><td><strong>强化学习算法</strong></td><td>Soft Actor–Critic (SAC)</td></tr><tr><td><strong>硬件环境</strong></td><td>Ubuntu/macOS, CPU / GPU 可选</td></tr><tr><td><strong>基础数据集</strong></td><td>EULP（Electric Utility Load Profiles, Montréal 冬季）</td></tr><tr><td><strong>住户行为模型</strong></td><td>Ecobee Donate Your Data（DYD）数据训练出的覆盖概率模型</td></tr><tr><td><strong>仿真周期</strong></td><td>冬季三个月（12 月–2 月）</td></tr><tr><td><strong>建筑数量</strong></td><td>10 栋独立住宅</td></tr><tr><td><strong>仿真粒度</strong></td><td>1 小时步长（24×90 steps）</td></tr><tr><td><strong>DR 事件</strong></td><td>工作日 18:00–21:00 设定点下调 1.1°C (≈2°F)</td></tr><tr><td><strong>对照组</strong></td><td>LoD1: 基线，无控制；LoD2: ±2°C 舒适  带，RL 控制；LoD3: ±2°C+覆盖模型+DR 事件</td></tr><tr><td><strong>输出指标</strong></td><td>电费成本、峰值功率、总耗电量、覆盖次数与覆盖幅度</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="对比">对比<a href="#对比" class="hash-link" aria-label="Direct link to 对比" title="Direct link to 对比">​</a></h2>
<table><thead><tr><th style="text-align:left">项目</th><th style="text-align:left">4.1 Basic Control</th><th style="text-align:left">4.2 Community Coordination</th><th style="text-align:left">4.3 Multi-Objective (Economic/Emission)</th><th style="text-align:left"><strong>4.4 Comfort Feedback (本节)</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>研究重点</strong></td><td style="text-align:left">单建筑基本负载控制</td><td style="text-align:left">多建筑间能量协调</td><td style="text-align:left">多目标权衡（成本 vs 排放）</td><td style="text-align:left">住户舒适反馈与 DR 响应</td></tr><tr><td style="text-align:left"><strong>数据集</strong></td><td style="text-align:left">简化住宅负载</td><td style="text-align:left">社区级 EULP</td><td style="text-align:left">同上</td><td style="text-align:left">同上（+ DYD 行为模型）</td></tr><tr><td style="text-align:left"><strong>控制目标</strong></td><td style="text-align:left">成本最小化</td><td style="text-align:left">成本 + 负载平衡</td><td style="text-align:left">成本 + 排放</td><td style="text-align:left">成本 + 舒适度（减少覆盖次数）</td></tr><tr><td style="text-align:left"><strong>外部信号</strong></td><td style="text-align:left">电价</td><td style="text-align:left">电价</td><td style="text-align:left">电价 + 排放因子</td><td style="text-align:left">电价 + DR 事件</td></tr><tr><td style="text-align:left"><strong>住户模型</strong></td><td style="text-align:left">固定设定温度</td><td style="text-align:left">固定设定温度</td><td style="text-align:left">固定设定温度</td><td style="text-align:left">动态设定温度 + 覆盖行为</td></tr><tr><td style="text-align:left"><strong>LoD (复杂度)</strong></td><td style="text-align:left">LoD1</td><td style="text-align:left">LoD1–2</td><td style="text-align:left">LoD1–2</td><td style="text-align:left">LoD1–3</td></tr><tr><td style="text-align:left"><strong>强化学习结构</strong></td><td style="text-align:left">单智能体 SAC</td><td style="text-align:left">多智能体 SAC</td><td style="text-align:left">多目标 SAC (Reward = αCost + βEmission)</td><td style="text-align:left">多目标 SAC (Reward = αCost + βComfort)</td></tr><tr><td style="text-align:left"><strong>评价指标</strong></td><td style="text-align:left">能耗/成本</td><td style="text-align:left">能耗/峰值</td><td style="text-align:left">成本+排放指标</td><td style="text-align:left">成本+峰值+覆盖次数</td></tr></tbody></table>
<p>总结来说，4.4 在 4.3 基础上加入人的因素（住户舒适反馈）</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/rl">RL</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/assets/25-AI classification">AI世界大入门</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-27T00:00:00.000Z">October 27, 2025</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/95482898?v=4" alt="zqqqj"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zqqqqqqj1110" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">zqqqj</span></a></div><small class="authorTitle_nd0D" title="super bug engineer 4 nlp,robot,cv,ml and ds">super bug engineer 4 nlp,robot,cv,ml and ds</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">introduction<a href="#introduction" class="hash-link" aria-label="Direct link to introduction" title="Direct link to introduction">​</a></h2>
<p>这篇文章旨在理解一大堆杂七杂八的，狗屁倒灶的，ai 方向的专用名词，例 AI，NLP，CV，深度学习，强化学习等等等
我相信初学者肯定会对这些名词感到困惑，就如同第一天我在面试时提出的问题：
“我就只会数学建模和西瓜皮上的那些算法，好奇的问一下深度学习是啥？”
这个问题对现在的我来说也相当困惑，当然我相信写完这篇文章会让我的理顺这些东西</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preliminary-knowledge">preliminary knowledge<a href="#preliminary-knowledge" class="hash-link" aria-label="Direct link to preliminary knowledge" title="Direct link to preliminary knowledge">​</a></h2>
<p>首先，给我整个 AI 的框架</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">人工智能（Artificial Intelligence, AI）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 机器学习（Machine Learning, ML）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 监督学习（Supervised Learning）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 无监督学习（Unsupervised Learning）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 强化学习（Reinforcement Learning, RL）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── 其他（半监督、主动学习等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 深度学习（Deep Learning, DL）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 神经网络（CNN, RNN, Transformer）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 自监督学习（Self-supervised）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 生成模型（GAN, Diffusion, VAE）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── PINNs / SciML（物理引导模型）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── 应用领域</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── NLP（自然语言处理）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── CV（计算机视觉）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── Speech（语音）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └─  ─ 多模态 / 大模型（GPT, Gemini, etc.）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>按照参差结构来讲，先从最简单的开始吧</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-应用领域">1. 应用领域<a href="#1-应用领域" class="hash-link" aria-label="Direct link to 1. 应用领域" title="Direct link to 1. 应用领域">​</a></h3>
<p>搜索算法，符号推理这些其实都可以类比到实习中的“搜推广”（搜索推荐广告）算法工程师。这些东西其实都可以归结为应用领域或技术范式。如下所示</p>
<table><thead><tr><th>名称</th><th>类别</th><th>解释</th></tr></thead><tbody><tr><td><strong>NLP（自然语言处理）</strong></td><td>应用领域</td><td>使用深度学习模型（如 Transformer）处理文本</td></tr><tr><td><strong>CV（计算机视觉）</strong></td><td>应用领域</td><td>使用 CNN 或 ViT 处理图像</td></tr><tr><td><strong>Diffusion / GAN / VAE</strong></td><td>生成模型</td><td>深度学习中的一种模型类型（生成任务）</td></tr><tr><td><strong>大模型（Foundation Model）</strong></td><td>模型规模/范式</td><td>基于深度学习（Transformer）的通用大模型，如 GPT、Gemini</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-机器学习">2. 机器学习<a href="#2-机器学习" class="hash-link" aria-label="Direct link to 2. 机器学习" title="Direct link to 2. 机器学习">​</a></h3>
<p>机器学习就是大部分西瓜皮上的内容了，他的本意就是“让计算机自己去学习”，所以就会自然而言的牵扯到两大类别，即无监督学习和有监督学习，具体含义如下</p>
<table><thead><tr><th>类型</th><th>中文含义</th><th>训练方式</th><th>示例</th></tr></thead><tbody><tr><td><strong>监督学习 (Supervised Learning)</strong></td><td>有标签学习</td><td>已知 输入与期望输出，通过最小化预测误差进行训练</td><td>分类、回归、图像识别</td></tr><tr><td><strong>无监督学习 (Unsupervised Learning)</strong></td><td>无标签学习</td><td>在未标注数据中自动提取潜在结构或模式</td><td>聚类、降维、自编码器</td></tr><tr><td><strong>强化学习 (Reinforcement Learning)</strong></td><td>奖励驱动学习</td><td>智能体与环境交互，通过试错获得最大累计奖励</td><td>游戏 AI、机器人控制</td></tr></tbody></table>
<p>对于强化学习而言，这部分会在后续着重介绍（因为我真的不懂）。但是一般而言，按照“想让机器学到什么”的定义，又可如下分类
· 监督学习用于“从已有示例中学习”
· 无监督学习用于“理解数据结构”
· 强化学习用于“学习行动策略”</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-深度学习">3. 深度学习<a href="#3-深度学习" class="hash-link" aria-label="Direct link to 3. 深度学习" title="Direct link to 3. 深度学习">​</a></h3>
<p>深度学习是机器学习的一个重要分支，可以理解为使用多层神经网络（Neural Networks）自动学习数据特征的一类方法
换句话说，它依然遵循“最小化误差（loss function）”的思想，但与传统机器学习不同，<br>
<!-- -->深度学习不再需要人手去“提取特征”，而是通过层层网络结构自动完成特征提取与抽象表示</p>
<p>从集合关系上看：
深度学习 ⊂ 神经网络 ⊂ 机器学习 ⊂ 人工智能
例子：</p>
<table><thead><tr><th>层级</th><th>学到的特征（以图像识别为例）</th></tr></thead><tbody><tr><td>第 1 层</td><td>学到边缘、线条等简单模式</td></tr><tr><td>第 2 层</td><td>学到角点、纹理、局部形状</td></tr><tr><td>第 3 层</td><td>学到眼睛、鼻子等复杂结构</td></tr><tr><td>第 4 层及以上</td><td>学到“猫脸”“汽车”等语义概念</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="difference-between-deep-learningdl-and-machine-learningml">difference between Deep Learning（DL） and machine Learning（ML）<a href="#difference-between-deep-learningdl-and-machine-learningml" class="hash-link" aria-label="Direct link to difference between Deep Learning（DL） and machine Learning（ML）" title="Direct link to difference between Deep Learning（DL） and machine Learning（ML）">​</a></h2>
<p>尽管两者的本质都是最小化误差（如 loss function），但核心目的是不同的。ML 的目的是寻找使预测误差最小的参数。（比如在 n 次线性函数中找最优参数，神经网络调整通过 Adam 反向传播调整网络权重）</p>
<table><thead><tr><th>算法</th><th>优化目标</th><th>损失函数举例</th></tr></thead><tbody><tr><td>线性回归</td><td>拟合直线</td><td>MSE（均方误差）</td></tr><tr><td>逻辑回归</td><td>分类概率</td><td>交叉熵（Cross Entropy）</td></tr><tr><td>SVM</td><td>最大化间隔</td><td>Hinge Loss</td></tr><tr><td>决策树</td><td>信息增益最大化</td><td>熵（Entropy）</td></tr></tbody></table>
<p>DL 也确实是继承了这个想法（最小化误差），但它的关键区别在于 “模型复杂度” 和 “特征获取方式”</p>
<table><thead><tr><th>方面</th><th>机器学习（ML）</th><th>深度学习（DL）</th></tr></thead><tbody><tr><td>特征</td><td>需要人工提取（feature engineering）</td><td>网络自动学习特征</td></tr><tr><td>模型结构</td><td>简单模型（线性/树/核函数）</td><td>多层非线性神经网络</td></tr><tr><td>参数规模</td><td>少（几十～几百）</td><td>多（百万～数十亿）</td></tr><tr><td>优化方法</td><td>梯度下降、凸优化</td><td>反向传播 + SGD/Adam</td></tr><tr><td>可解释性</td><td>强</td><td>弱</td></tr><tr><td>数据需求</td><td>较少</td><td>巨量数据</td></tr></tbody></table>
<p>其实可以理解为，DL 本质就是神经网络，只是这个网络又大（神经元）又深（多层）。深度学习不只是有神经网络，还包括优化算法、损失函数、正则化、数据增强等。神经网络是模型，深度学习是方法。
最大的目的就是：<strong>为了学习特征。区别在于可以更好的处理高度非线形问题</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="强化学习">强化学习<a href="#强化学习" class="hash-link" aria-label="Direct link to 强化学习" title="Direct link to 强化学习">​</a></h2>
<p>说了这么多，终于可以讲强化学习了，强化学习是让智能体（Agent）通过与环境（Environment）交互，并根据奖励（Reward）反馈，学习最优决策策略（Policy）的方法。
需要注意的是，这是一个最大化优化，不是 loss 这样的最小化优化（奖励必然是越多越好）</p>
<p>继续举例五大基本元素</p>
<table><thead><tr><th>元素</th><th>英文</th><th>含义</th><th>举例（机器人走迷宫）</th></tr></thead><tbody><tr><td><strong>Agent</strong></td><td>智能体</td><td>负责做决策的学习者</td><td>机器人本身</td></tr><tr><td><strong>Environment</strong></td><td>环境</td><td>Agent 所处的世界</td><td>迷宫</td></tr><tr><td><strong>State</strong></td><td>状态（s）</td><td>当前环境的观测</td><td>机器人现在的位置</td></tr><tr><td><strong>Action</strong></td><td>动作（a）</td><td>Agent 可以执行的操作</td><td>向上/下/左/右移动</td></tr><tr><td><strong>Reward</strong></td><td>奖励（r）</td><td>环境给的反馈信号</td><td>到终点+1，撞墙-1</td></tr></tbody></table>
<p>p-code 如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for episode in range(N):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state = env.reset()     # Agent观察环境（init啦其实就是）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while not done:     # 开始训练</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action = agent.select_action(state)     # 选择一个动作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        next_state, reward, done = env.step(action)     # 环境给出新的状态和奖励；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent.learn(state, action, reward, next_state)  # Agent根据奖励更新策略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state = next_state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>所以，强化学习不是预测一个矢量或标量，他的目的应该是学习一种<strong>策略</strong></p>
<p>ps：some cases</p>
<table><thead><tr><th>领域</th><th>应用场景</th><th>说明</th></tr></thead><tbody><tr><td>游戏</td><td>AlphaGo、Atari、Dota2</td><td>通过自我博弈学习最优策略</td></tr><tr><td>机器人控制</td><td>行走、抓取、平衡</td><td>连续动作空间优化</td></tr><tr><td>自动驾驶</td><td>路径规划、决策控制</td><td>学习最优驾驶策略</td></tr><tr><td>智能电网</td><td>城市能源优化（CityLearn）</td><td>控制能耗和储能系统</td></tr><tr><td>金融</td><td>投资组合优化</td><td>最大化长期收益</td></tr></tbody></table></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/rl">RL</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">文档</h4></div><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/FEMATHS" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>